<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://perror.dev</id>
    <title>perror</title>
    <updated>2023-02-17T12:20:09.757Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://perror.dev"/>
    <link rel="self" href="https://perror.dev/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://perror.dev/images/avatar.png</logo>
    <icon>https://perror.dev/favicon.ico</icon>
    <rights>All rights reserved 2023, perror</rights>
    <entry>
        <title type="html"><![CDATA[install fluxcd in k8s 1.25.5]]></title>
        <id>https://perror.dev/post/install-fluxcd-in-k8s-1255/</id>
        <link href="https://perror.dev/post/install-fluxcd-in-k8s-1255/">
        </link>
        <updated>2023-02-17T12:09:22.000Z</updated>
        <content type="html"><![CDATA[<ol>
<li>install the flux cli: <code>brew install fluxcd/tap/flux</code></li>
<li>show the flux cli version: <code>flux version</code></li>
</ol>
<pre><code>   âœ  ~ flux version
flux: v0.39.0
helm-controller: v0.26.0
image-automation-controller: v0.26.1
image-reflector-controller: v0.22.1
kustomize-controller: v0.30.0
notification-controller: v0.28.0
source-controller: v0.31.0
</code></pre>
<ol start="3">
<li>create git repo on github</li>
<li>set GITHUB_TOKEN env</li>
<li>install the flux cd to k8s: <code>flux bootstrap github --owner=&lt;you-github-name&gt; --repository=&lt;you-repo&gt; --path=./ --components-extra=image-reflector-controller,image-automation-controller  --read-write-key --branch=main</code>, <em>Don't forget <code>--components-extra=image-reflector-controller,image-automation-controller</code></em>, Only when this parameter is used can image-related pods be created.</li>
<li>wait flux cd pod up.</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[mysql error: rec.cc:391 thread ]]></title>
        <id>https://perror.dev/post/mysql-error-reccc391-thread/</id>
        <link href="https://perror.dev/post/mysql-error-reccc391-thread/">
        </link>
        <updated>2023-02-17T12:03:02.000Z</updated>
        <content type="html"><![CDATA[<p>This error only in the mysql 8.0.30 version.see https://bugs.mysql.com/bug.php?id=107941 bug report. Upgrade mysql version to 8.0.31 to resolve this error</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¦‚ä½•æ¸…ç† Kubernetes namespace ä¸­çš„ finalizers å¹¶æˆåŠŸåˆ é™¤ argocd namespace]]></title>
        <id>https://perror.dev/post/shan-chu-argocd-namespace-fa-sheng-cuo-wu-some-content-in-the-namespace-has-finalizers-remaining-resources-finalizerargocdargoprojio-in-10-resource-instances/</id>
        <link href="https://perror.dev/post/shan-chu-argocd-namespace-fa-sheng-cuo-wu-some-content-in-the-namespace-has-finalizers-remaining-resources-finalizerargocdargoprojio-in-10-resource-instances/">
        </link>
        <updated>2023-02-14T02:25:51.000Z</updated>
        <content type="html"><![CDATA[<p>åœ¨åˆ é™¤ Kubernetes é›†ç¾¤ä¸­çš„èµ„æºæ—¶ï¼Œæˆ‘éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ é™¤æ‰€æœ‰ <code>deploy</code>ã€‚</li>
<li>åˆ é™¤æ‰€æœ‰ <code>configmap</code>ã€‚</li>
<li>åˆ é™¤æ‰€æœ‰ <code>namespace</code>ã€‚</li>
</ol>
<p>Â Â ç„¶è€Œï¼Œæˆ‘å‘ç°åœ¨åˆ é™¤ <code>namespace</code> æ—¶å‡ºç°äº†é—®é¢˜ã€‚å°è¯•äº†å®˜æ–¹æä¾›çš„å‘½ä»¤<br>
<code>kubectl delete -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code><br>
ä½†æ˜¯ <code>namespace</code> åˆ é™¤ä»ç„¶è¢«å¡ä½äº†ã€‚æˆ‘æ³¨æ„åˆ°è¯¥ <code>namespace</code> ä¸‹å­˜åœ¨å¤šä¸ª <code>argoproj.io/v1alpha1/applications</code> èµ„æºï¼Œå¹¶ä¸”æ‰€æœ‰èµ„æºéƒ½åŒ…å«ä¸€ä¸ª <code>finalizers</code> å­—æ®µã€‚é€šè¿‡æœç´¢å¼•æ“ï¼Œæˆ‘äº†è§£åˆ°åªæœ‰åˆ é™¤æ‰€æœ‰èµ„æº YAML æ–‡ä»¶ä¸­çš„ <code>finalizers</code> å­—æ®µæ‰èƒ½è§£å†³ <code>namespace</code> åˆ é™¤è¢«å¡ä½çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ç›´æ¥åˆ é™¤äº† <code>finalizers</code> å­—æ®µå¹¶æ›´æ–°äº†æ‰€æœ‰èµ„æºï¼Œç›´åˆ°æ‰€æœ‰èµ„æºéƒ½è¢«ä¿®æ”¹å¥½ä¸ºæ­¢ã€‚æœ€ç»ˆï¼Œ<code>namespace</code> èƒ½å¤Ÿè¢«æˆåŠŸåˆ é™¤ã€‚<br>
Â Â åœ¨ Kubernetes ä¸­ï¼Œåˆ é™¤æŸäº›èµ„æºæ—¶ï¼Œè¿™äº›èµ„æºå¯èƒ½å…·æœ‰å…³è”çš„å…¶ä»–èµ„æºï¼Œè¿™äº›å…³è”èµ„æºéœ€è¦è¢«æ¸…ç†ï¼Œä»¥ä¾¿èƒ½å¤Ÿé¡ºåˆ©åˆ é™¤è¦åˆ é™¤çš„èµ„æºã€‚å½“æŸä¸ª <code>namespace</code> ä¸­å­˜åœ¨å…³è”èµ„æºæ—¶ï¼Œåˆ é™¤è¯¥ <code>namespace</code> å¯èƒ½ä¼šå¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKubernetes ä¼šåœ¨ <code>namespace</code> å¯¹åº”çš„ <code>finalizers</code> åˆ—è¡¨ä¸­æ·»åŠ ä¸€äº›æ¡ç›®ï¼Œä»¥ç¡®ä¿æ‰€æœ‰å…³è”èµ„æºè¢«æ¸…ç†ï¼Œç„¶åå†åˆ é™¤ <code>namespace</code>ã€‚åœ¨åˆ é™¤ <code>namespace</code> æ—¶ï¼ŒKubernetes ä¼šæ£€æŸ¥ <code>finalizers</code> åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼Œç¡®ä¿è¿™äº›æ¡ç›®å¯¹åº”çš„æ‰€æœ‰èµ„æºå·²è¢«æ¸…ç†ï¼Œç„¶åæ‰ä¼šç»§ç»­åˆ é™¤ <code>namespace</code>ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[helm æŠ¥é”™ï¼šanother operation (install/upgrade/rollback) is in progresså¤„ç†æ–¹æ³•]]></title>
        <id>https://perror.dev/post/helm-bao-cuo-another-operation-installupgraderollback-is-in-progress-chu-li-fang-fa/</id>
        <link href="https://perror.dev/post/helm-bao-cuo-another-operation-installupgraderollback-is-in-progress-chu-li-fang-fa/">
        </link>
        <updated>2023-02-01T07:46:36.000Z</updated>
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>ä½¿ç”¨flux cdæ¥ç®¡ç†helmreleases</p>
<h3 id="é”™è¯¯ä¿¡æ¯">é”™è¯¯ä¿¡æ¯</h3>
<p>å•ä¸ªhelmreleaseæŠ¥é”™ï¼šanother operation (install/upgrade/rollback) is in progressã€‚</p>
<h3 id="å¤„ç†æ–¹å¼">å¤„ç†æ–¹å¼</h3>
<ol>
<li>è¿è¡Œ <code>helm history &lt;name&gt; --namespace &lt;ns&gt;</code><br>
<img src="https://perror.dev/post-images/1675238086770.jpeg" alt="" loading="lazy"></li>
<li>è¿è¡Œï¼š <code>lux suspend hr &lt;name&gt; -n &lt;ns&gt;</code></li>
<li>é€‰æ‹©status=pending-upgradeçš„ç‰ˆæœ¬ï¼Œè¿è¡Œï¼š <code>helm uninstall &lt;name&gt; --namespace &lt;ns&gt; &lt;REVISION&gt;</code></li>
<li>è¿è¡Œï¼š <code>flux resume helmrelease &lt;name&gt; -n &lt;ns&gt;</code></li>
</ol>
<p>æå®šğŸ˜Š</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s PVCè‡ªåŠ¨æ‰©å®¹å®è·µ ]]></title>
        <id>https://perror.dev/post/k8s-pvc-zi-dong-kuo-rong-shi-jian/</id>
        <link href="https://perror.dev/post/k8s-pvc-zi-dong-kuo-rong-shi-jian/">
        </link>
        <updated>2022-10-27T09:07:29.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¾èµ–:</p>
<ol>
<li>k8s &gt;= 1.24</li>
<li><a href="https://github.com/topolvm/pvc-autoresizer">pvc-autoresizer</a> &gt;= 0.5.0</li>
</ol>
<p>ä¸€ã€å®‰è£… pvc-autoresizer</p>
<ul>
<li>build  and push docker é•œåƒ <code>git clone https://github.com/topolvm/pvc-autoresizer &amp;&amp; git checkout v0.5.0 &amp;&amp; cd pvc-autoresizer &amp;&amp; docker build -t pvc-autoresizer:0.5.0 . &amp;&amp; docker push pvc-autoresizer:0.5.0</code></li>
<li>æ·»åŠ  helm repo: <code>helm repo add pvc-autoresizer https://topolvm.github.io/pvc-autoresizer/</code></li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<p>ä¾èµ–:</p>
<ol>
<li>k8s &gt;= 1.24</li>
<li><a href="https://github.com/topolvm/pvc-autoresizer">pvc-autoresizer</a> &gt;= 0.5.0</li>
</ol>
<p>ä¸€ã€å®‰è£… pvc-autoresizer</p>
<ul>
<li>build  and push docker é•œåƒ <code>git clone https://github.com/topolvm/pvc-autoresizer &amp;&amp; git checkout v0.5.0 &amp;&amp; cd pvc-autoresizer &amp;&amp; docker build -t pvc-autoresizer:0.5.0 . &amp;&amp; docker push pvc-autoresizer:0.5.0</code></li>
<li>æ·»åŠ  helm repo: <code>helm repo add pvc-autoresizer https://topolvm.github.io/pvc-autoresizer/</code></li>
</ul>
  <!-- more -->
<ul>
<li>values.yaml</li>
</ul>
<pre><code># config from https://github.com/topolvm/pvc-autoresizer/blob/main/charts/pvc-autoresizer/values.yaml
image:
  # image.repository -- pvc-autoresizer image repository to use.
  repository: perrorone/pvc-autoresizer

  # image.tag -- pvc-autoresizer image tag to use.
  # @default -- `{{ .Chart.AppVersion }}`
  tag:  v0.5.0

controller:
  # controller.replicas -- Specify the number of replicas of the controller Pod.
  replicas: 1

  args:
    # controller.args.prometheusURL -- Specify Prometheus URL to query volume stats.
    # Used as &quot;--prometheus-url&quot; option
    prometheusURL: &lt;you_prometheus_url&gt;
</code></pre>
<ul>
<li>å®‰è£… pvc-autoresizer: <code>helm install --create-namespace --namespace pvc-autoresizer pvc-autoresizer pvc-autoresizer/pvc-autoresizer --values ./values.yaml&quot;</code></li>
<li>æ£€æŸ¥æ˜¯å¦æˆåŠŸ <code>kubectl get pod -n pvc-autoresizer | grep pvc-autoresizer</code></li>
</ul>
<p>äºŒã€ åˆ›å»ºStatefulSetä»¥åŠå­˜å‚¨ç±»</p>
<ul>
<li>ç¼–å†™stateful-set.yaml:</li>
</ul>
<pre><code>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: test-pvc-autoresizer
  namespace: staging
  annotations:
    resize.topolvm.io/enabled: &quot;true&quot; # å¿…é¡»å­˜åœ¨, æ‰èƒ½è‡ªåŠ¨æ‰©å®¹
parameters:
  type: pd-ssd
provisioner: pd.csi.storage.gke.io
reclaimPolicy: Retain
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: test-pvc-autoresizer
  namespace: staging
spec:
  selector:
    matchLabels:
      app: test-pvc-autoresizer
  serviceName: &quot;test-pvc-autoresizer&quot;
  replicas: 1
  template:
    metadata:
      labels:
        app: test-pvc-autoresizer
    spec:
      terminationGracePeriodSeconds: 10
      containers:
        - name: test-pvc-autoresizer
          image: perrorone/go-file:v1.0.0
          ports:
            - containerPort: 80
              name: http
          livenessProbe:
            httpGet:
              path: /health
              port: http
          readinessProbe:
            httpGet:
              path: /health
              port: http
          volumeMounts:
            - name: test-pvc-data
              mountPath: /data
          resources:
            requests:
              cpu: 200m
              memory: 300Mi
            limits:
              cpu: 500m
              memory: 500Mi
  volumeClaimTemplates:
    - metadata:
        name: test-pvc-data
        annotations:  # å¿…é¡»å­˜åœ¨, ä½¿å¾—è‡ªåŠ¨åˆ›å»ºçš„ PVCæºå¸¦ä»¥ä¸‹è®¾ç½®æƒ³æ‰èƒ½è‡ªåŠ¨æ‰©å®¹
            resize.topolvm.io/storage_limit: 8Gi # æœ€å¤§æ‰©å®¹å¤§å°
            resize.topolvm.io/threshold: 20%
      spec:
        accessModes: [ &quot;ReadWriteOnce&quot; ]
        storageClassName: &quot;test-pvc-autoresizer&quot;
        resources:
          requests:
            storage: 1Gi
</code></pre>
<ul>
<li>éƒ¨ç½²: <code>kubectl apply -f ./stateful-set.yaml</code></li>
</ul>
<p>ä¸‰ã€æµ‹è¯•</p>
<ul>
<li>
<p>è¿›å…¥podä¸­æ£€æŸ¥æŒ‚è½½ç›®å½•å¤§å°, <code>df -h</code> è¾“å‡ºå¯ä»¥çœ‹åˆ°<code>/data</code>ç›®å½•åªä½¿ç”¨äº†1%ç©ºé—´</p>
</li>
<li>
<p>å†™å…¥æ–‡ä»¶æµ‹è¯•è‡ªåŠ¨æ‰©å®¹: <code>dd if=/dev/zero of=1G.file bs=50M count=20</code></p>
</li>
<li>
<p>æ£€æŸ¥pvc-autoresizer pod æ—¥å¿—<br>
<img src="https://perror.dev/post-images/1666863168702.jpg" alt="" loading="lazy"></p>
</li>
<li>
<p>å†æ¬¡æ£€æŸ¥podæŒ‚è½½ç›®å½•å¤§å°, å¯ä»¥çœ‹è§æŒ‚è½½ç›®å½•å·²ç»ä½¿ç”¨äº†100%: <code>/dev/sdf                975.9M    959.9M         0 100% /data</code></p>
</li>
<li>
<p>ç­‰å¾…ä¸€ä¼š,å†æ¬¡æŸ¥çœ‹æŒ‚è½½ç›®å½•å¤§å°, å¯ä»¥çœ‹è§å·²ç»æ‰©å®¹æˆåŠŸ: <code>/dev/sdf                  1.9G    960.4M   1007.4M  49% /data</code> ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹<br>
<img src="https://perror.dev/post-images/1666863439959.jpg" alt="" loading="lazy"></p>
</li>
</ul>
]]></content>
    </entry>
</feed>