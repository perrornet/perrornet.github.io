<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>install fluxcd in k8s 1.25.5</title>
      <link href="/2023/02/18/install-fluxcd-in-k8s-1-25-5/"/>
      <url>/2023/02/18/install-fluxcd-in-k8s-1-25-5/</url>
      
        <content type="html"><![CDATA[<ol><li>install the flux cli: <code>brew install fluxcd/tap/flux</code></li><li>show the flux cli version: <code>flux version</code><pre class="line-numbers language-none"><code class="language-none">   âœ  ~ flux versionflux: v0.39.0helm-controller: v0.26.0image-automation-controller: v0.26.1image-reflector-controller: v0.22.1kustomize-controller: v0.30.0notification-controller: v0.28.0source-controller: v0.31.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>create git repo on github</li><li>set GITHUB_TOKEN env</li><li>install the flux cd to k8s: <code>flux bootstrap github --owner=&lt;you-github-name&gt; --repository=&lt;you-repo&gt; --path=./ --components-extra=image-reflector-controller,image-automation-controller  --read-write-key --branch=main</code>, <em>Donâ€™t forget <code>--components-extra=image-reflector-controller,image-automation-controller</code></em>, Only when this parameter is used can image-related pods be created.</li><li>wait flux cd pod up.</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql error: rec.cc:391 thread </title>
      <link href="/2023/02/18/mysql-error-rec-cc-391-thread/"/>
      <url>/2023/02/18/mysql-error-rec-cc-391-thread/</url>
      
        <content type="html"><![CDATA[<p>This error only in the mysql 8.0.30 version.see <a href="https://bugs.mysql.com/bug.php?id=107941">https://bugs.mysql.com/bug.php?id=107941</a> bug report. Upgrade mysql version to 8.0.31 to resolve this error</p>]]></content>
      
      
      
        <tags>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ¸…ç† Kubernetes namespace ä¸­çš„ finalizers å¹¶æˆåŠŸåˆ é™¤ argocd namespace</title>
      <link href="/2023/02/18/ru-he-qing-li-kubernetes-namespace-zhong-de-finalizers-bing-cheng-gong-shan-chu-argocd-namespace/"/>
      <url>/2023/02/18/ru-he-qing-li-kubernetes-namespace-zhong-de-finalizers-bing-cheng-gong-shan-chu-argocd-namespace/</url>
      
        <content type="html"><![CDATA[<p>åœ¨åˆ é™¤ Kubernetes é›†ç¾¤ä¸­çš„èµ„æºæ—¶ï¼Œæˆ‘éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>åˆ é™¤æ‰€æœ‰ <code>deploy</code>ã€‚</li><li>åˆ é™¤æ‰€æœ‰ <code>configmap</code>ã€‚</li><li>åˆ é™¤æ‰€æœ‰ <code>namespace</code>ã€‚</li></ol><p>&amp;nbsp;&amp;nbsp;ç„¶è€Œï¼Œæˆ‘å‘ç°åœ¨åˆ é™¤ <code>namespace</code> æ—¶å‡ºç°äº†é—®é¢˜ã€‚å°è¯•äº†å®˜æ–¹æä¾›çš„å‘½ä»¤<br><code>kubectl delete -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code><br>ä½†æ˜¯ <code>namespace</code> åˆ é™¤ä»ç„¶è¢«å¡ä½äº†ã€‚æˆ‘æ³¨æ„åˆ°è¯¥ <code>namespace</code> ä¸‹å­˜åœ¨å¤šä¸ª <code>argoproj.io/v1alpha1/applications</code> èµ„æºï¼Œå¹¶ä¸”æ‰€æœ‰èµ„æºéƒ½åŒ…å«ä¸€ä¸ª <code>finalizers</code> å­—æ®µã€‚é€šè¿‡æœç´¢å¼•æ“ï¼Œæˆ‘äº†è§£åˆ°åªæœ‰åˆ é™¤æ‰€æœ‰èµ„æº YAML æ–‡ä»¶ä¸­çš„ <code>finalizers</code> å­—æ®µæ‰èƒ½è§£å†³ <code>namespace</code> åˆ é™¤è¢«å¡ä½çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ç›´æ¥åˆ é™¤äº† <code>finalizers</code> å­—æ®µå¹¶æ›´æ–°äº†æ‰€æœ‰èµ„æºï¼Œç›´åˆ°æ‰€æœ‰èµ„æºéƒ½è¢«ä¿®æ”¹å¥½ä¸ºæ­¢ã€‚æœ€ç»ˆï¼Œ<code>namespace</code> èƒ½å¤Ÿè¢«æˆåŠŸåˆ é™¤ã€‚<br>&amp;nbsp;&amp;nbsp;åœ¨ Kubernetes ä¸­ï¼Œåˆ é™¤æŸäº›èµ„æºæ—¶ï¼Œè¿™äº›èµ„æºå¯èƒ½å…·æœ‰å…³è”çš„å…¶ä»–èµ„æºï¼Œè¿™äº›å…³è”èµ„æºéœ€è¦è¢«æ¸…ç†ï¼Œä»¥ä¾¿èƒ½å¤Ÿé¡ºåˆ©åˆ é™¤è¦åˆ é™¤çš„èµ„æºã€‚å½“æŸä¸ª <code>namespace</code> ä¸­å­˜åœ¨å…³è”èµ„æºæ—¶ï¼Œåˆ é™¤è¯¥ <code>namespace</code> å¯èƒ½ä¼šå¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKubernetes ä¼šåœ¨ <code>namespace</code> å¯¹åº”çš„ <code>finalizers</code> åˆ—è¡¨ä¸­æ·»åŠ ä¸€äº›æ¡ç›®ï¼Œä»¥ç¡®ä¿æ‰€æœ‰å…³è”èµ„æºè¢«æ¸…ç†ï¼Œç„¶åå†åˆ é™¤ <code>namespace</code>ã€‚åœ¨åˆ é™¤ <code>namespace</code> æ—¶ï¼ŒKubernetes ä¼šæ£€æŸ¥ <code>finalizers</code> åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼Œç¡®ä¿è¿™äº›æ¡ç›®å¯¹åº”çš„æ‰€æœ‰èµ„æºå·²è¢«æ¸…ç†ï¼Œç„¶åæ‰ä¼šç»§ç»­åˆ é™¤ <code>namespace</code>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>helm æŠ¥é”™ï¼šanother operation (install/upgrade/rollback) is in progresså¤„ç†æ–¹æ³•</title>
      <link href="/2023/02/18/helm-bao-cuo-another-operation-install-upgrade-rollback-is-in-progress-chu-li-fang-fa/"/>
      <url>/2023/02/18/helm-bao-cuo-another-operation-install-upgrade-rollback-is-in-progress-chu-li-fang-fa/</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ä½¿ç”¨flux cdæ¥ç®¡ç†helmreleases</p><h3 id="é”™è¯¯ä¿¡æ¯"><a href="#é”™è¯¯ä¿¡æ¯" class="headerlink" title="é”™è¯¯ä¿¡æ¯"></a>é”™è¯¯ä¿¡æ¯</h3><p>å•ä¸ªhelmreleaseæŠ¥é”™ï¼šanother operation (install/upgrade/rollback) is in progressã€‚</p><h3 id="å¤„ç†æ–¹å¼"><a href="#å¤„ç†æ–¹å¼" class="headerlink" title="å¤„ç†æ–¹å¼"></a>å¤„ç†æ–¹å¼</h3><ol><li>è¿è¡Œ <code>helm history &lt;name&gt; --namespace &lt;ns&gt;</code><br><img src="/medias/1675238086770.jpeg"></li><li>è¿è¡Œï¼š <code>lux suspend hr &lt;name&gt; -n &lt;ns&gt;</code></li><li>é€‰æ‹©status=pending-upgradeçš„ç‰ˆæœ¬ï¼Œè¿è¡Œï¼š <code>helm uninstall &lt;name&gt; --namespace &lt;ns&gt; &lt;REVISION&gt;</code></li><li>è¿è¡Œï¼š <code>flux resume helmrelease &lt;name&gt; -n &lt;ns&gt;</code></li></ol><p>æå®šğŸ˜Š</p>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s PVCè‡ªåŠ¨æ‰©å®¹å®è·µ</title>
      <link href="/2023/02/18/k8s-pvc-zi-dong-kuo-rong-shi-jian/"/>
      <url>/2023/02/18/k8s-pvc-zi-dong-kuo-rong-shi-jian/</url>
      
        <content type="html"><![CDATA[<p>ä¾èµ–:</p><ol><li>k8s &gt;= 1.24</li><li><a href="https://github.com/topolvm/pvc-autoresizer">pvc-autoresizer</a> &gt;= 0.5.0</li></ol><p>ä¸€ã€å®‰è£… pvc-autoresizer</p><ul><li><p>build  and push docker é•œåƒ <code>git clone https://github.com/topolvm/pvc-autoresizer &amp;&amp; git checkout v0.5.0 &amp;&amp; cd pvc-autoresizer &amp;&amp; docker build -t pvc-autoresizer:0.5.0 . &amp;&amp; docker push pvc-autoresizer:0.5.0</code></p></li><li><p>æ·»åŠ  helm repo: <code>helm repo add pvc-autoresizer https://topolvm.github.io/pvc-autoresizer/</code></p><span id="more"></span></li><li><p>values.yaml</p><pre class="line-numbers language-none"><code class="language-none"># config from https://github.com/topolvm/pvc-autoresizer/blob/main/charts/pvc-autoresizer/values.yamlimage:  # image.repository -- pvc-autoresizer image repository to use.  repository: perrorone/pvc-autoresizer  # image.tag -- pvc-autoresizer image tag to use.  # @default -- `{{ .Chart.AppVersion }}`  tag:  v0.5.0controller:  # controller.replicas -- Specify the number of replicas of the controller Pod.  replicas: 1  args:    # controller.args.prometheusURL -- Specify Prometheus URL to query volume stats.    # Used as "--prometheus-url" option    prometheusURL: &lt;you_prometheus_url&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å®‰è£… pvc-autoresizer: <code>helm install --create-namespace --namespace pvc-autoresizer pvc-autoresizer pvc-autoresizer/pvc-autoresizer --values ./values.yaml"</code></p></li><li><p>æ£€æŸ¥æ˜¯å¦æˆåŠŸ <code>kubectl get pod -n pvc-autoresizer | grep pvc-autoresizer</code></p></li></ul><p>äºŒã€ åˆ›å»ºStatefulSetä»¥åŠå­˜å‚¨ç±»</p><ul><li>ç¼–å†™stateful-set.yaml:<pre class="line-numbers language-none"><code class="language-none">apiVersion: storage.k8s.io/v1kind: StorageClassmetadata:  name: test-pvc-autoresizer  namespace: staging  annotations:    resize.topolvm.io/enabled: "true" # å¿…é¡»å­˜åœ¨, æ‰èƒ½è‡ªåŠ¨æ‰©å®¹parameters:  type: pd-ssdprovisioner: pd.csi.storage.gke.ioreclaimPolicy: RetainvolumeBindingMode: WaitForFirstConsumerallowVolumeExpansion: true---apiVersion: apps/v1kind: StatefulSetmetadata:  name: test-pvc-autoresizer  namespace: stagingspec:  selector:    matchLabels:      app: test-pvc-autoresizer  serviceName: "test-pvc-autoresizer"  replicas: 1  template:    metadata:      labels:        app: test-pvc-autoresizer    spec:      terminationGracePeriodSeconds: 10      containers:        - name: test-pvc-autoresizer          image: perrorone/go-file:v1.0.0          ports:            - containerPort: 80              name: http          livenessProbe:            httpGet:              path: /health              port: http          readinessProbe:            httpGet:              path: /health              port: http          volumeMounts:            - name: test-pvc-data              mountPath: /data          resources:            requests:              cpu: 200m              memory: 300Mi            limits:              cpu: 500m              memory: 500Mi  volumeClaimTemplates:    - metadata:        name: test-pvc-data        annotations:  # å¿…é¡»å­˜åœ¨, ä½¿å¾—è‡ªåŠ¨åˆ›å»ºçš„ PVCæºå¸¦ä»¥ä¸‹è®¾ç½®æƒ³æ‰èƒ½è‡ªåŠ¨æ‰©å®¹            resize.topolvm.io/storage_limit: 8Gi # æœ€å¤§æ‰©å®¹å¤§å°            resize.topolvm.io/threshold: 20%      spec:        accessModes: [ "ReadWriteOnce" ]        storageClassName: "test-pvc-autoresizer"        resources:          requests:            storage: 1Gi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li>éƒ¨ç½²: <code>kubectl apply -f ./stateful-set.yaml</code></li></ul><p>ä¸‰ã€æµ‹è¯•</p><ul><li><p>è¿›å…¥podä¸­æ£€æŸ¥æŒ‚è½½ç›®å½•å¤§å°, <code>df -h</code> è¾“å‡ºå¯ä»¥çœ‹åˆ°<code>/data</code>ç›®å½•åªä½¿ç”¨äº†1%ç©ºé—´</p></li><li><p>å†™å…¥æ–‡ä»¶æµ‹è¯•è‡ªåŠ¨æ‰©å®¹: <code>dd if=/dev/zero of=1G.file bs=50M count=20</code></p></li><li><p>æ£€æŸ¥pvc-autoresizer pod æ—¥å¿—<br><img src="/medias/1666863168702.jpg"></p></li><li><p>å†æ¬¡æ£€æŸ¥podæŒ‚è½½ç›®å½•å¤§å°, å¯ä»¥çœ‹è§æŒ‚è½½ç›®å½•å·²ç»ä½¿ç”¨äº†100%: <code>/dev/sdf                975.9M    959.9M         0 100% /data</code></p></li><li><p>ç­‰å¾…ä¸€ä¼š,å†æ¬¡æŸ¥çœ‹æŒ‚è½½ç›®å½•å¤§å°, å¯ä»¥çœ‹è§å·²ç»æ‰©å®¹æˆåŠŸ: <code>/dev/sdf                  1.9G    960.4M   1007.4M  49% /data</code> ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹<br><img src="/medias/1666863439959.jpg"></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> devops </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisçš„ä¸€äº›å°çŸ¥è¯†</title>
      <link href="/2023/02/18/redis-de-yi-xie-xiao-zhi-shi/"/>
      <url>/2023/02/18/redis-de-yi-xie-xiao-zhi-shi/</url>
      
        <content type="html"><![CDATA[<h4 id="redisçš„æ•°æ®ç±»å‹ä½¿ç”¨åœºåˆï¼Ÿ"><a href="#redisçš„æ•°æ®ç±»å‹ä½¿ç”¨åœºåˆï¼Ÿ" class="headerlink" title="redisçš„æ•°æ®ç±»å‹ä½¿ç”¨åœºåˆï¼Ÿ"></a>redisçš„æ•°æ®ç±»å‹ä½¿ç”¨åœºåˆï¼Ÿ</h4><ul><li>stringï¼šå…¶valueå¯ä»¥å‚¨å­˜stringä»¥åŠæ•°å­—ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºå¤æ‚çš„æŠ€æœ¯åŠŸèƒ½ä¸Šã€‚</li><li>hashï¼šå…¶valueå­˜æ”¾çš„æ˜¯ç»“æ„åŒ–çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥èƒ½æ–¹ä¾¿çš„å»æ“ä½œæŸä¸ªå­—æ®µï¼Œæˆ‘ä½¿ç”¨ä»–å®ç°è¿‡ç”¨æˆ·è¡Œä¸ºæ•°æ®ç¼“å­˜ä»¥åŠsessionåŠŸèƒ½ã€‚</li><li>listï¼šç±»ä¼¼pythonä¸­çš„listæ•°æ®ç±»å‹ï¼Œæˆ‘ä¸€èˆ¬ä½¿ç”¨ä»–åšæ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…åˆ†é¡µåŠŸèƒ½ã€‚</li><li>setï¼šè¯¥æ•°æ®ç»“æ„å‚¨å­˜çš„æ˜¯ä¸€ç³»åˆ—æ— åºã€ä¸é‡å¤çš„æ•°æ®ï¼Œè¿™ä¸ªè¿˜æä¾›å·®é›†ã€äº¤é›†ç­‰ç­‰åŠŸèƒ½ï¼Œ æˆ‘ä½¿ç”¨å®ƒä¸ºçˆ¬è™«å»é‡ä»¥åŠç”¨æˆ·é˜…è¯»è¿‡çš„æ–‡ç« åŠŸèƒ½ã€‚</li><li>sorted sortï¼šæœ‰åºé›†åˆå‚¨å­˜ä¸€ç³»åˆ—æœ‰åºï¼Œä¸é‡å¤çš„æ•°æ®ï¼Œå¤§å¤šæ•°åœºæ™¯éƒ½ä½¿ç”¨ä»–åšä¸€ä¸ªæ¦œå•çš„åŠŸèƒ½ã€‚</li></ul><span id="more"></span><h4 id="redisçš„ä¸€äº›ç¼ºç‚¹"><a href="#redisçš„ä¸€äº›ç¼ºç‚¹" class="headerlink" title="redisçš„ä¸€äº›ç¼ºç‚¹"></a>redisçš„ä¸€äº›ç¼ºç‚¹</h4><ul><li>rediså°†æ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ä»¥ä¾¿åŠ å¿«è®¿é—®çš„é€Ÿåº¦ï¼Œä½†æ˜¯è¿™ä¹Ÿé€ æˆäº†rediså®¹é‡å—åˆ°ç‰©ç†å†…å­˜å¤§å°çš„é™åˆ¶ï¼Œæ‰€ä»¥rediså¯¹äºä¸€äº›æµ·é‡æ•°æ®åœºæ™¯æœ‰äº›ä¹åŠ›ã€‚</li><li>redisçš„åœ¨çº¿æ‰©å®¹æ¯”è¾ƒçš„éº»çƒ¦ï¼Œå¦‚æœredisé›†ç¾¤æ•°é‡åˆ°è¾¾ä¸Šé™æ—¶ï¼Œæ­¤æ—¶åœ¨çº¿æ‰©å®¹æ˜¯ä¸€ä¸ªååˆ†å¤æ‚çš„é—®é¢˜ï¼Œ è¿™å¤§å¤§æé«˜äº†è¿ç»´çš„æˆæœ¬ã€‚</li></ul><h4 id="redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶"><a href="#redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶" class="headerlink" title="redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶"></a>redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶</h4><ul><li>redisé‡‡ç”¨äº†å®šæ—¶åˆ é™¤ + æƒ°æ€§åˆ é™¤çš„æ–¹å¼æ¥åˆ é™¤è¿‡æœŸçš„æ•°æ®ï¼Œè¿™é‡Œçš„å®šæ—¶åˆ é™¤ï¼Œrediså¹¶éå°†æ‰€æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éå†ä¸€éï¼Œ å¦‚æœè¿™æ ·åšå°†ä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æºã€‚redisé‡‡ç”¨äº†éšæœºæŠ½æ ·ï¼Œå¦‚æœè¢«æŠ½åˆ°çš„keyè¿‡æœŸäº†å°±åˆ é™¤ï¼Œä½†æ˜¯å¦‚æœä»…ä»…æ—¶è¿™æ ·ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¸€äº›æ•°æ®æ°¸è¿œä¸ä¼šè¢«æŠ½åˆ°ï¼Œè¿™æ—¶rediså¼•å…¥äº†æƒ°æ€§åˆ é™¤ï¼Œ åœ¨è®¿é—®KEYçš„æ—¶å€™æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ é™¤ã€‚</li><li>å¦‚æœredisä»…ä»…é‡‡ç”¨ä¸Šé¢ä¸¤ç§æ–¹å¼æ¥åˆ é™¤æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æç«¯æƒ…å†µä¸‹ä»ç„¶ä¼šæœ‰æ•°æ®ä¸ä¼šè¢«åˆ é™¤ã€‚redisè¿˜æœ‰å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œæˆ‘æœ€é•¿ä½¿ç”¨çš„æ˜¯allkeys-lruï¼Œ å½“rediså†…å­˜åˆ°è¾¾ä¸Šé™æ—¶ï¼Œ ä»–ä»æ‰€æœ‰keyä¸­å¯»æ‰¾æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„KEYåˆ é™¤ã€‚</li></ul><h4 id="å¤§é‡æ•°æ®æ’å…¥redisåº”è¯¥æ€ä¹ˆåšï¼Ÿ"><a href="#å¤§é‡æ•°æ®æ’å…¥redisåº”è¯¥æ€ä¹ˆåšï¼Ÿ" class="headerlink" title="å¤§é‡æ•°æ®æ’å…¥redisåº”è¯¥æ€ä¹ˆåšï¼Ÿ"></a>å¤§é‡æ•°æ®æ’å…¥redisåº”è¯¥æ€ä¹ˆåšï¼Ÿ</h4><p>ä½¿ç”¨æ­£å¸¸æ¨¡å¼æ¥æ’å…¥æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ï¼Œ è€Œä½¿ç”¨ç®¡é“çš„è¯æŸäº›å®¢æˆ·ç«¯ä¼šè¢«é˜»å¡ï¼Œå¯¼è‡´ä¸èƒ½åœ¨è¿™æœŸé—´æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ã€‚æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯æ ¹æ®Redisåè®®ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œåä½¿ç”¨pipe modeå»æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚å‚è€ƒ<a href="https://redis.io/docs/reference/patterns/bulk-loading/">Redis Mass Insertion</a>ã€‚</p><h4 id="redisåˆ†åŒºï¼Ÿ"><a href="#redisåˆ†åŒºï¼Ÿ" class="headerlink" title="redisåˆ†åŒºï¼Ÿ"></a>redisåˆ†åŒºï¼Ÿ</h4><ul><li>redisçš„åˆ†åŒºæ˜¯æŒ‡å°†æ•°æ®åˆ†å‰²æˆå¤šä¸ªå­é›†ï¼Œåˆ†åˆ«ä¿å­˜åˆ°ä¸åŒçš„rediså®ä¾‹ä¸­ï¼Œ æ¯ä¸€ä¸ªrediså®ä¾‹éƒ½åªä¿å­˜äº†KEYçš„ä¸€ä¸ªå­é›†ã€‚</li><li>redisçš„åˆ†åŒºåœ¨æ¶‰åŠå¤šä¸ªkeyæ“ä½œçš„æ—¶å€™ï¼Œå¤šæ•°æ˜¯ä¸æ”¯æŒçš„ï¼Œè·Ÿä¸è¦è¯´å¤škeyäº‹åŠ¡æ“ä½œã€‚å¯¹äºå¤‡ä»½çš„æƒ…å†µä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚</li><li>redisåˆ†åŒºæœ‰ä¸¤ç§ç±»å‹ï¼š<ol><li>æŒ‰ç…§èŒƒå›´åˆ†åŒºï¼Œ æ˜ å°„ä¸€å®šèŒƒå›´çš„å¯¹è±¡åˆ°ç‰¹å®šçš„Rediså®ä¾‹ï¼Œä½†æ˜¯è¿™ç§å¹¶ä¸é•¿ä½¿ç”¨ã€‚ â€ƒ</li><li>ä½¿ç”¨hashåˆ†åŒºï¼Œå…¶å·¥ä½œåŸç†ä½¿ç”¨äº†hashè¡¨çš„åŸç†ï¼Œç±»ä¼¼python dictã€‚</li></ol></li></ul><h4 id="rediså¦‚ä½•åšé›†ç¾¤ï¼Ÿ"><a href="#rediså¦‚ä½•åšé›†ç¾¤ï¼Ÿ" class="headerlink" title="rediså¦‚ä½•åšé›†ç¾¤ï¼Ÿ"></a>rediså¦‚ä½•åšé›†ç¾¤ï¼Ÿ</h4><p>æ¨èä½¿ç”¨å®˜æ–¹çš„<a href="https://redis.io/docs/management/scaling/">redis cluster</a>,å…¶å®ç°åŸç†æ˜¯ï¼šredisé›†ç¾¤å†…éƒ¨æœ‰2 ** 14ä¸ªå“ˆå¸Œæ§½ï¼Œ å½“éœ€è¦æ’å…¥keyæ—¶ï¼Œ é¦–å…ˆå¯¹keyä½¿ç”¨<a href="https://baike.baidu.com/item/%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%E7%A0%81/10168758?fr=aladdin&amp;fromtitle=CRC%E6%A0%A1%E9%AA%8C&amp;fromid=3439037">crc16ç®—æ³•</a>è®¡ç®—å‡ºä¸€ä¸ªæ•°å­—ï¼Œåœ¨ç”¨æ­¤æ•°å­—å¯¹2 ** 14 å–ä½™ï¼Œè¯¥å–ä½™ç»“æœå°±æ˜¯æ•°æ®å­˜æ”¾çš„å“ˆå¸Œæ§½ä½ç½®ã€‚è€Œredisé›†ç¾¤çš„èŠ‚ç‚¹ç®¡ç†è¿™ä½¿ç”¨ç±»ä¼¼å“¨å…µçš„æœºåˆ¶æ¥å®ç°ï¼Œ é›†ç¾¤ç±»èŠ‚ç‚¹é€šè¿‡ç›¸äº’pingæ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿè¿æ¥ï¼Œ å¦‚æœè¿‡åŠæ•°èŠ‚ç‚¹éƒ½è¿æ¥ä¸ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™redisé›†ç¾¤å°±ä¼šè®¤å®šæ­¤èŠ‚ç‚¹å®•æœºäº†ã€‚è¯¥æ–¹æ¡ˆç¡®å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ä¸€å®šä¸è¦å°†redisä½œä¸ºä¸€ä¸ªé«˜å¯é æ€§çš„å­˜å‚¨æœåŠ¡ä½¿ç”¨ï¼</p><h4 id="redisæ—¶å¦‚ä½•åšæŒä¹…åŒ–ï¼Ÿ"><a href="#redisæ—¶å¦‚ä½•åšæŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="redisæ—¶å¦‚ä½•åšæŒä¹…åŒ–ï¼Ÿ"></a>redisæ—¶å¦‚ä½•åšæŒä¹…åŒ–ï¼Ÿ</h4><p>redisæ”¯æŒä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š â€ƒâ€ƒ</p><ol><li>å¿«ç…§ï¼š é€šè¿‡å¯¹é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼Œ å¯ä»¥ä½¿å¾—redisåœ¨Nç§’ç±»Mä¸ªkeyè¢«ä¿®æ”¹æ—¶å°±å°†å†…å­˜çš„æ•°æ®ä»¥å¿«ç…§çš„æ–¹å¼å†™å…¥åˆ°åç¼€ä¸ºâ€™.rdbâ€™æ–‡ä»¶ä¸­ã€‚ â€ƒâ€ƒ</li><li>aof: æ¯ä¸€æ¬¡æ”¶åˆ°ä¸€æ¬¡å†™çš„å‘½ä»¤å°±å°†æ­¤å‘½ä»¤è¿½åŠ åˆ°åç¼€ä¸ºâ€™.aofâ€™æ–‡ä»¶ä¸­ï¼Œ å½“redisé‡å¯æ—¶ä¼šé€šè¿‡é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­ä¿å­˜çš„å†™å‘½ä»¤æ¥åœ¨å†…å­˜ä¸­é‡å»ºæ•´ä¸ªæ•°æ®åº“çš„å†…å®¹ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>castç±»å‹è½¬æ¢åº“â€”goåº“æ¨è</title>
      <link href="/2023/02/18/cast-lei-xing-zhuan-huan-ku-go-ku-tui-jian/"/>
      <url>/2023/02/18/cast-lei-xing-zhuan-huan-ku-go-ku-tui-jian/</url>
      
        <content type="html"><![CDATA[<p>golang ä¸­å„ç§ç±»å‹ä¹‹é—´çš„è½¬æ¢å®åœ¨æ˜¯å¤ªè¿‡äºç¹çï¼Œä½†æ˜¯ç±»å‹è½¬æ¢åååˆæ˜¯æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ“ä½œã€‚åŒç±»å‹ä¹‹é—´è½¬æ¢è¿˜ç¨å¾®å¥½ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®ç±»å‹å‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œä½†æ˜¯æƒ³è¦è½¬æ¢ä¸åŒçš„ç±»å‹å´éœ€è¦å¼•å…¥ä¸åŒçš„åº“ï¼Œ è€Œ cast åº“æ­£å¥½è§£å†³äº†è¿™ä¸€ç—›ç‚¹ï¼Œå®ƒæä¾›äº†å¾ˆå¤šç§çš„ç±»å‹è½¬æ¢å‡½æ•°åŒæˆ‘ä»¬ä½¿ç”¨ï¼Œ é€šå¸¸çš„ç±»å‹è½¬æ¢æˆ‘ä»¬åªéœ€è¦å¼•å…¥è¿™ä¸€ä¸ªåº“å°±å¯ä»¥è§£å†³ã€‚</p><span id="more"></span><p>é€šå¸¸ go ä¸­çš„ç±»å‹è½¬æ¢éƒ½éœ€è¦ err å˜é‡æ¥æç¤ºç±»å‹ä¸å¯è½¬æ¢ï¼Œcast åº“æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>ä»…è¿”å›è¯¥ç±»å‹çš„é›¶å€¼ï¼Œä¸ä¼šè¿”å› err</li><li>ä½¿ç”¨å‡½æ•° To__E å°†ä¼šè¿”å›ä¸€ä¸ª err å˜é‡æ¥å‘Šè¯‰æˆ‘ä»¬æ˜¯å¦å‘ç”Ÿé”™è¯¯è¿™æ ·åˆ†å¼€æä¾›å‡½æ•°ï¼Œæå¤§çš„æ–¹ä¾¿æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ ¹æ®å½“å‰æ‰€éœ€é€‰æ‹©å‡½æ•°ã€‚</li></ol><p>å¸¸ç”¨ API åˆ—è¡¨ï¼š</p><ul><li><p>cast.StringToDate: å°†å¸¸è§çš„æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸º time.Time ç±»å‹</p><pre class="line-numbers language-none"><code class="language-none">fmt.Println(cast.StringToDate("2006-01-02 15:04:05")) // output: 2006-01-02 15:04:05 +0000 UTC &lt;nil&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>cast.ToBoolSlice: å°†ä»»æ„ç±»å‹çš„æ•°ç»„è½¬æ¢ä¸º []bool ç±»å‹</p><pre class="line-numbers language-none"><code class="language-none">fmt.Println(cast.ToBoolSlice([]interface{}{1,2,0,true, false})) // output: [true true false true false]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>cast.ToBool: å°†ä»»æ„ç±»å‹è½¬æ¢ä¸º bool ç±»å‹</p><pre class="line-numbers language-none"><code class="language-none">fmt.Println(cast.ToBool(1)) // output:truefmt.Println(cast.ToBool(0)) // output: falsefmt.Println(cast.ToBool("")) // output: falsefmt.Println(cast.ToBool("0")) // output: falsefmt.Println(cast.ToBool("1")) // output: truefmt.Println(cast.ToBool("true")) // output: truefmt.Println(cast.ToBool("false")) // output: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>cast.ToString: å°†ä»»æ„ç±»å‹è½¬æ¢æˆ string</p><pre class="line-numbers language-none"><code class="language-none">cast.ToString("mayonegg")         // "mayonegg"cast.ToString(8)                  // "8"cast.ToString(8.31)               // "8.31"cast.ToString([]byte("one time")) // "one time"cast.ToString(nil)        // "nil"var foo interface{} = "one more time"cast.ToString(foo)                // "one more time"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>cast.ToStringMap: å°†ä»»æ„ç±»å‹ map è½¬æ¢æˆ map[string]interface{}</p><pre class="line-numbers language-none"><code class="language-none">fmt.Println(cast.ToStringMap(map[interface{}]interface{}{    1:2,    "2":3,    true:1,})) // output: map[1:2 2:3 true:1]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´å¤šçš„ API å¯æŸ¥çœ‹å…¶æ–‡æ¡£ï¼š<a href="https://github.com/spf13/cast">https://github.com/spf13/cast</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis sdsè¯¦è§£</title>
      <link href="/2023/02/18/sds-xiang-jie/"/>
      <url>/2023/02/18/sds-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯SDSï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SDSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SDSï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SDSï¼Ÿ</h3><p>SDSæ˜¯redisæ„å»ºçš„ä¸€ç§æŠ½è±¡ç±»å‹ï¼Œä¸»è¦ç”¨äºå‚¨å­˜redisçš„é»˜è®¤å­—ç¬¦ä¸²è¡¨ç¤ºã€AOFæ¨¡å—ä¸­çš„AOFç¼“å†²åŒºã€å®¢æˆ·ç«¯çŠ¶æ€è¾“å…¥ç¼“å†²åŒºã€‚</p><span id="more"></span><h3 id="SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"><a href="#SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"></a>SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h3><p>redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨Cçš„å­—ç¬¦ä¸²ï¼Ÿæˆ‘ä»¬è¦å…ˆæ¥çœ‹çœ‹Cå­—ç¬¦ä¸²ä¸­çš„ç¼ºç‚¹ï¼š</p><ol><li>Cå­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦ä¿¡æ¯ï¼Œä¸ºäº†è·å–å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</li><li>ç”±äºCå­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦ï¼Œç¨æœ‰ä¸å°å¿ƒå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚</li><li>å¯¹äºredisè¿™ç§ç¼“å­˜ç±»å‹æ•°æ®åº“ï¼Œå¯¹äºç¼“å­˜çš„Valueæ˜¯æœ‰å¯èƒ½ç»å¸¸çš„æ›´æ”¹çš„ã€‚ä½†æ˜¯Cå­—ç¬¦ä¸²æ¯æ¬¡çš„å¢é•¿æˆ–æ˜¯ç¼©å°éƒ½éœ€è¦ä¸€æ¬¡å†…å­˜çš„é‡åˆ†é…æ“ä½œã€‚</li><li>redisæ•°æ®åº“ä¸­ç¼“å­˜çš„å†…å®¹ä¸æ˜¯ç‰¹å®šçš„ï¼Œæœ‰å¯èƒ½ä¼šæ˜¯å›¾ç‰‡ã€éŸ³é¢‘ç­‰ç­‰æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä½†æ˜¯Cå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å¿…é¡»ç¬¦åˆæŸç§ç¼–ç ï¼Œä¸”å­—ç¬¦ä¸²ä¸­ä¸èƒ½åŒ…å«ç©ºæ ¼ï¼Œè¿™äº›é™åˆ¶ä¹Ÿå¯¼è‡´äº†redisä¸èƒ½ä½¿ç”¨Cå­—ç¬¦ä¸²æ¥ä½œä¸ºè‡ªèº«å­—ç¬¦ä¸²çš„å®ç°ã€‚ è€ŒSDSåˆ™å°†è¿™äº›ç¼ºç‚¹éƒ½ä¸€ä¸€æœç»ï¼š<br>â€ƒâ€ƒâ€ƒâ€ƒ1. SDSè®°å½•äº†è‡ªèº«çš„é•¿åº¦ä¿¡æ¯ï¼Œä½¿å¾—è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚<br>â€ƒâ€ƒâ€ƒâ€ƒ2. SDSä½¿ç”¨äº†é¢„åˆ†é…ç©ºé—´ä»¥åŠæƒ°æ€§ç©ºé—´é‡Šæ”¾çš„ç®—æ³•ï¼Œè§£å†³äº†é¢‘ç¹åˆ†é…å†…å­˜çš„æ“ä½œã€‚<br>â€ƒâ€ƒâ€ƒâ€ƒ3. SDSç”±äºä¿å­˜äº†è‡ªèº«çš„é•¿åº¦ï¼Œä¹Ÿå¯¼è‡´äº†SDSä¸ä¼šåƒCä¸€æ ·æŒ‰ç…§â€™\0â€™ç¡®å®šå­—ç¬¦ä¸²çš„ç»“å°¾ã€‚</li></ol><h3 id="SDSæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#SDSæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="SDSæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>SDSæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>redisä½¿ç”¨åä¸ºsdshdrçš„ç»“æ„ä½“è¡¨ç¤ºSDSå€¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">struct sdshdr{int len; // è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡int free; // è®°å½•bufä¸­æœªä½¿ç”¨å­—èŠ‚æ•°é‡char buf[]; // ä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SDSéµå¾ªè¿™Cå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„æƒ¯ä¾‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿé‡ç”¨Cå­—ç¬¦ä¸²ä¸­çš„å‡½æ•°ï¼Œè¿™ä¸ªç»“å°¾çš„ç©ºå­—ç¬¦ä¸²å¹¶ä¸ä¼šå¢åŠ lenå­—æ®µçš„å€¼ï¼Œä¾‹å¦‚ç°åœ¨éœ€è¦ä½¿ç”¨SDSä¿å­˜â€™golangâ€™è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆSDSå¯¹åº”çš„ç»“æ„ä½“æ˜¯ï¼š<br><a href="https://imgtu.com/i/qNgzqI"><img src="https://s1.ax1x.com/2022/03/25/qNgzqI.png" alt="qNgzqI.png"></a></p><p>ç”±äºSDSè®°å½•äº†è‡ªèº«çš„é•¿åº¦ï¼Œæ‰€ä»¥redisä¸­è·å–å­—ç¬¦ä¸²çš„é•¿åº¦åªéœ€è¦è¿”å›lenå­—æ®µçš„å­—æ®µï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€Œå¯¹äºCå­—ç¬¦ä¸²ç»å¸¸å‘ç”Ÿçš„ç¼“å†²åŒºæº¢å‡ºï¼ŒSDSçš„ç©ºé—´åˆ†é…ç­–ç•¥å®Œå…¨æœç»äº†è¿™ç§å¯èƒ½æ€§ï¼šå½“rediséœ€è¦å¯¹SDSå­—ç¬¦ä¸²ä¿®æ”¹æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥SDSçš„ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„ç©ºé—´ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™å°†SDSç©ºé—´æ‰©å®¹è‡³æ»¡è¶³è¯¥ä¿®æ”¹ç©ºé—´æ‰€éœ€çš„å®¹é‡ï¼ŒSDSç©ºé—´æ‰©å®¹çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><pre><code>1. å¦‚æœSDSä¿®æ”¹åçš„é•¿åº¦å°äº1MBï¼Œé‚£ä¹ˆç¨‹åºå°†ä¼šåˆ†é…lenå­—æ®µå€¼åŒæ ·å¤§å°çš„æœªä½¿ç”¨ç©ºé—´ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸Šé¢ç»™å‡ºçš„ä¾‹å›¾ä¸­lençš„å€¼æ˜¯6ï¼Œfreeå€¼ä¹Ÿæ˜¯6çš„åŸå› ã€‚å¯¹äºä¸Šé¢é‚£ä¸ªä¾‹å­ï¼ŒSDSçš„æ€»å ç”¨å¤§å°ä¸ºï¼š6(len) + 6(free) + 1('\0â€™) = 13å­—èŠ‚çš„å®¹é‡ã€‚2.  å¦‚æœSDSä¿®æ”¹åçš„é•¿åº¦å¤§äº1MBï¼Œé‚£ä¹ˆSDSå°†ä¼šä¸ºSDSåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ã€‚å¦‚æœä¸€ä¸ªSDS lenå€¼ä¿®æ”¹åçš„å®¹é‡ä¸º2MBï¼Œé‚£ä¹ˆrediså°†ä¼šä¸ºSDSåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ã€‚åˆ™æ­¤æ—¶SDSçš„æ€»å ç”¨å¤§å°ä¸ºï¼š2MB(len) + 1MB(len) + 1byte('\0â€™) =3073 byteå®¹é‡ã€‚</code></pre><p>è¿™ç§æ‰©å®¹ç®—æ³•ï¼Œå‡å°‘äº†é¢‘ç¹çš„å‘ç³»ç»Ÿç”³è¯·å†…å­˜çš„æ“ä½œã€‚SDSçš„ç©ºé—´é‡Šæ”¾å¹¶ä¸æ˜¯å®æ—¶çš„ï¼Œè€Œæ˜¯æƒ°æ€§é‡Šæ”¾ï¼šredisè®¤ä¸ºå¦‚æœä¸€ä¸ªSDSçš„å®¹é‡åˆ°è¾¾è¿‡Nå¤§å°ï¼Œåˆ™ææœ‰å¯èƒ½åœ¨å…¶ç¼©å°åä¹Ÿæœ‰å¯èƒ½åˆ°è¾¾Nï¼Œä¸”æƒ°æ€§é‡Šæ”¾ä¹Ÿå‡å°‘äº†ä¸‹æ¬¡å†…å­˜åˆ†é…çš„å¯èƒ½ï¼Œå‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªâ€™golangâ€™å­—ç¬¦ä¸²å­˜å‚¨åœ¨redisä¸­ï¼Œ ç°åœ¨æˆ‘ä»¬éœ€è¦å°†â€™golangâ€™ä¿®æ”¹ä¸ºâ€™goâ€™ï¼Œé‚£ä¹ˆrediså°†ä¼šå¯¹SDSç»“æ„ä½“å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š<br><a href="https://imgtu.com/i/qN2RTP"><img src="https://s1.ax1x.com/2022/03/25/qN2RTP.png" alt="qN2RTP.png"></a><br><a href="https://imgtu.com/i/qN24fS"><img src="https://s1.ax1x.com/2022/03/25/qN24fS.png" alt="qN24fS.png"></a><br>SDSæä¾›äº†æ¸…ç†å†…å­˜çš„APIï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ‰éœ€è¦æ—¶ï¼Œè°ƒç”¨è¯¥APIä»¥ä¾¿çœŸæ­£çš„é‡Šæ”¾å†…å­˜ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li><p>redisåªä¼šä½¿ç”¨Cå­—ç¬¦ä¸²ä½œä¸ºå­—é¢é‡ä½¿ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µéƒ½ä½¿ç”¨SDSæ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚</p></li><li><p>èƒ½å¤Ÿä½¿ç”¨å¸¸æ•°çº§å¤æ‚åº¦è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p></li><li><p>æœç»äº†ç¼“å†²åŒºæº¢å‡ºã€‚</p></li><li><p>å‡å°‘äº†å­—ç¬¦ä¸²æ‰€éœ€å†…å­˜é‡æ–°åˆ†é…çš„æ¬¡æ•°ã€‚ä»¥åŠå¯¹äºäºŒè¿›åˆ¶æ•°æ®å®‰å…¨ï¼Œä¸”å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goçš„channelè¯¦è§£</title>
      <link href="/2023/02/18/go-de-channel-xiang-jie/"/>
      <url>/2023/02/18/go-de-channel-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>æ­¤ç‰‡æ–‡ç« åŸºäº<a href="https://studygolang.com/dl/golang/go1.12.1.src.tar.gz">golang 1.12.1</a>ç‰ˆæœ¬æºç è§£æè€Œæˆï¼Œchanæºç ä½äºgo/src/runtime/chan.goæ–‡ä»¶ä¸­ã€‚</p><span id="more"></span><h3 id="channelæ˜¯ä¸ªä»€ä¹ˆï¼Ÿ"><a href="#channelæ˜¯ä¸ªä»€ä¹ˆï¼Ÿ" class="headerlink" title="channelæ˜¯ä¸ªä»€ä¹ˆï¼Ÿ"></a>channelæ˜¯ä¸ªä»€ä¹ˆï¼Ÿ</h3><p>chan å®é™…åœ¨æºç ä¸­æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ç»“æ„å¦‚ä¸‹ï¼š</p> <pre class="line-numbers language-none"><code class="language-none"> type hchan struct {qcount   uint           // é˜Ÿåˆ—æ•°æ®ä¸­çš„æ•°æ®æ•°é‡dataqsiz uint           // å¾ªç¯é˜Ÿåˆ—çš„å¤§å°buf      unsafe.Pointer // å‚¨å­˜æ•°æ®çš„å…ƒç´ æ•°ç»„elemsize uint16closed   uint32elemtype *_type // å…ƒç´ ç±»å‹sendx    uint   // å‘é€æ¬¡æ•°recvx    uint   // æ¥å—æ¬¡æ•°recvq    waitq  // å½“é˜»å¡æ—¶ï¼Œå­˜æ”¾æ¥å—è€…çš„ç»“æ„ä½“sendq    waitq  // å½“é˜»å¡æ—¶ï¼Œå­˜æ”¾å‘é€è€…è€…çš„ç»“æ„ä½“// ç”¨äºä¿è¯æ•°æ®çš„å¹¶å‘å®‰å…¨lock mutex}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­sendxä»¥åŠrecvxä¸ºæ¯æ¬¡è¯»å–æˆ–è€…å†™å…¥éƒ½éœ€è¦å°†å…¶åŠ ä¸€ï¼Œè€Œrecvqã€sendqä½œç”¨æ˜¯æœ‰ç¼“å†²channelç¼“å†²å·²æ»¡çš„æƒ…å†µä¸‹ä¼šå°†è¯»å–æˆ–æ˜¯å‘é€channelç»“æ„ä½“æ”¾å…¥å…¶ä¸­ã€‚</p><h3 id="channelçš„åˆ›å»º"><a href="#channelçš„åˆ›å»º" class="headerlink" title="channelçš„åˆ›å»º"></a>channelçš„åˆ›å»º</h3><p>åˆ›å»ºä¸€ä¸ªchanæˆ‘ä»¬ä¼šä½¿ç”¨makeå‡½æ•°æ¥åˆ›å»ºï¼Œ å®é™…makeå‡½æ•°è°ƒç”¨äº†makechanå‡½æ•°åˆ›å»ºï¼Œè¯¥å‡½æ•°ç­¾åå¦‚ä¸‹ï¼šfunc makechan(t *chantype, size int) *hchan ï¼Œtæ˜¯chanæ¥æ”¶æˆ–è€…å‘é€çš„æ•°æ®ç±»å‹ï¼Œ sizeåˆ™æ˜¯makeå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒæŒ‡æ˜äº†chançš„ç¼“å†²å¤§å°ï¼Œé»˜è®¤ä¸º0å³æ— ç¼“å†²chan,è¿”å›hchanç»“æ„ä½“çš„æŒ‡é’ˆã€‚åˆ›å»ºchannelæ—¶é¦–å…ˆä¼šæ£€æµ‹tçš„å¤§å°ï¼Œå¦‚æœtçš„å¤§å°è¶…è¿‡äº†65536ä¸ªå­—èŠ‚çš„è¯ï¼Œå°†ä¼šè§¦å‘é”™è¯¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å®éªŒä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç±»å‹ï¼Œä½¿å¾—è¯¥ç±»å‹åœ¨è¢«åˆ›å»ºæ—¶å¤§å°å°±è¶…è¿‡65535å­—èŠ‚ï¼š</p><pre class="line-numbers language-none"><code class="language-none">// ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼å»åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œ è¯¥ç»“æ„æœ‰65536 / intSize +1ä¸ªintå…ƒç´ ç»„æˆvar d inta := "type A struct{\n"for i := 0; i&lt;= ((1&lt;&lt;16) / int(unsafe.Sizeof(d))) + 1; i++{a += fmt.Sprintf("\t\t\t\ta%d int\n", i)}a += "}"ioutil.WriteFile("./name.go", []byte(a), 07777)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æ„ä½“åˆ›å»ºå®Œæˆåï¼Œåœ¨mainå‡½æ•°ä¸­å°è¯•åœ¨chanä¸­ä¼ é€’è¿™ç§æ•°æ®:_ = make(chan A)ï¼Œæ­¤æ—¶è¯¥ä»£ç å°†ä¼šç¼–è¯‘ä¸é€šè¿‡å¹¶å‘å‡ºé”™è¯¯ï¼šâ€™ channel element type too large (&gt;64kB)â€™ã€‚å½“chanä¼ é€’çš„æ•°æ®ç±»å‹å¤§å°ç¬¦åˆè¦æ±‚åï¼Œå°†ä¼šæ ¹æ®tç±»å‹çš„ç‰¹å¾å»åˆ›å»ºä¸€å®šå®¹é‡å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å°†æ­¤ç‰‡å†…å­˜ç©ºé—´å¤åˆ¶ç»™bufï¼Œç›´åˆ°æ­¤æ—¶ä¸€ä¸ªchannelå°±ç®—åˆ›å»ºhaoäº†ã€‚å€¼å¾—ä¸€æçš„æ˜¯chanåŒ…ä¸­æä¾›äº†ä¸€ä¸ªåç§°ä¸ºdebugChançš„å˜é‡ï¼Œè¯¥å˜é‡é»˜è®¤ä¸ºFalseï¼Œ å½“ä»–ä¸ºTrueæ—¶ï¼Œ å¯¹chanæ“ä½œæ—¶å°†ä¼šæ‰“å°ä¸€äº›debugä¿¡æ¯ï¼Œ è¿™å°†ä¼šå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å‘ç°ç”±äºchanå‘ç”Ÿçš„BUGã€‚</p><h3 id="å‘channelä¸­å‘é€æ•°æ®"><a href="#å‘channelä¸­å‘é€æ•°æ®" class="headerlink" title="å‘channelä¸­å‘é€æ•°æ®"></a>å‘channelä¸­å‘é€æ•°æ®</h3><p>å‘chanä¸­å‘é€æ•°æ®ç”±<a href="https://github.com/golang/go/blob/master/src/runtime/chan.go#71">chan.go: 142</a> chansendå‡½æ•°å®ç°ã€‚è¯¥å‡½æ•°é¦–å…ˆä¼šæ£€æŸ¥å½“å‰channelç­‰äºnilå¹¶ä¸”æ˜¯ä¸€ä¸ªæœ‰ç¼“å†²é€šé“åˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ— ç¼“å­˜é€šé“åˆ™è°ƒç”¨proc.gp:284 goparkå°†å½“å‰çš„goroutineè®¾ç½®ä¸ºwaitingçŠ¶æ€ã€‚éšåæ£€æµ‹channelæ—¶å€™å·²ç»å‡†å¤‡å¥½å‘é€æ•°æ®äº†ï¼Œå¦‚æœå·²ç»å¯ä»¥å‘é€æ•°æ®ï¼Œåˆ™è°ƒç”¨chan.go:264 sendå‡½æ•°å‘é€æ•°æ®ï¼Œsendçš„ä½œç”¨ä¸»è¦æ˜¯å°†è¦å‘é€çš„æ•°æ®copyåˆ°bufä¸­ï¼Œå¦‚æœå½“å‰channelæ˜¯æ— ç¼“å†²çš„ï¼Œåˆ™è°ƒç”¨lockåŠ é”ï¼Œé˜»å¡å½“å‰goroutineï¼Œå½“å‰æ•°æ®è¢«æ¥å—åï¼Œè°ƒç”¨goreadyé€šçŸ¥runtimeå½“å‰goroutineå·²ç»å‡†å¤‡å¥½å†æ¬¡è¿è¡Œäº†ã€‚å¦‚æœchannelæ˜¯æœ‰ç¼“å†²çš„ï¼Œ åˆ™ç›´æ¥è¿”å›ã€‚</p><h3 id="ä»channelä¸­æ¥å—æ•°æ®"><a href="#ä»channelä¸­æ¥å—æ•°æ®" class="headerlink" title="ä»channelä¸­æ¥å—æ•°æ®"></a>ä»channelä¸­æ¥å—æ•°æ®</h3><p>æ¥å—æ•°æ®å®é™…è·Ÿå‘é€æ•°æ®æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å½“å‰channelæ˜¯æœ‰ç¼“å†²çš„æ—¶å€™å¹¶ä¸”channelä¸­æ²¡æœ‰æ•°æ®è¢«å‘é€æ—¶ï¼Œ åˆ™ç›´æ¥å°†æ¥å—chanæ•°æ®çš„å˜é‡åœ°å€å­˜å…¥åˆ°sendqç»“æ„ä½“ä¸­ã€‚å½“æœ‰å‘é€æ•°æ®æ—¶å‘ç°recvqä¸­æœ‰æ•°æ®æ—¶ï¼Œ ç›´æ¥å°†æ•°æ®å­˜å…¥åˆ°è¿™ä¸ªç»“æ„ä½“ä¸­çš„åœ°å€ä¸­ï¼Œè€Œä¸å†ä¼šä½¿ç”¨bufå»copyæ•°æ®ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>channelä½¿ç”¨copy bufçš„æ–¹å¼æ¥é€šä¿¡ï¼Œ æœ€åå®ç°ä»¥é€šä¿¡çš„æ–¹å¼æ¥å…±äº«å†…å­˜ã€‚å½“ä¸€ä¸ªgoroutineé˜»å¡çš„æ—¶å€™ï¼Œç³»ç»Ÿçº¿ç¨‹ä¼šæŠŠå®ƒæ”¾å…¥åˆ°hchan.sendqæˆ–è€…hchan.recvq listä¸­ï¼Œ è¯¥listä¸­çš„sudogç±»å‹çš„ç»“æ„é¢˜å°±æ˜¯å½“å‰goruntineï¼Œ è€Œè¿™ä¸ªsudogç»“æ„ä½“ä¸­ä¿å­˜ç€ä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡ä¿å­˜ç€channelç›¸å…³çš„æŒ‡é’ˆã€‚ä¹‹å‰ä½¿ç”¨chanä»…ä»…åªæ˜¯ä¼šä½¿ç”¨ï¼Œè€Œä¸çŸ¥å…¶åŸç†ï¼Œ çœ‹äº†å…¶æºç ï¼Œä¹‹å‰ä¸ç†è§£çš„åœ°æ–¹ä¹Ÿæç„¶å¤§æ‚Ÿã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶æ˜¯å¯¹ç€æºç å†™çš„ï¼Œå¯èƒ½æœ‰ä¸€äº›é¡ºåºä¸Šçš„çŸ›ç›¾ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python IOå¤šè·¯å¤ç”¨å®è·µ</title>
      <link href="/2023/02/18/io-duo-lu-fu-yong-shi-jian/"/>
      <url>/2023/02/18/io-duo-lu-fu-yong-shi-jian/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‡ å¤©ä¸€ç›´åœ¨çœ‹tornadoæºç ï¼Œå‘ç°torandoè™½ç„¶æ ‡æ¦œä½¿ç”¨å¼‚æ­¥æ¨¡å‹å®ç°ï¼Œ ä½†æ˜¯å®é™…ä¸Šæ˜¯ä½¿ç”¨IOå¤šè·¯å¤ç”¨å®ç°çš„äº‹ä»¶å¾ªç¯ï¼Œä¸ºäº†èƒ½å¯¹ IOå¤šè·¯å¤ç”¨åŠ æ·±å°è±¡ï¼Œå†³å®šè‡ªå·±å®ç°ä¸€ä¸ªç®€æ˜“çš„HTTPå®¢æˆ·ç«¯å¯¹æ¯”ä¸€ä¸‹åŒæ­¥å®¢æˆ·ç«¯å’ŒIOå¤šè·¯å¤ç”¨å®¢æˆ·ç«¯çš„æ€§èƒ½å·®åˆ«ã€‚</p><span id="more"></span><p>åºŸè¯å°‘è¯´ï¼Œ ç°åœ¨å…ˆæ¥çœ‹çœ‹åŒæ­¥å®¢æˆ·ç«¯ä¸IOå¤šè·¯å¤ç”¨å®¢æˆ·ç«¯æœ€ç›´è§‚çš„åŒºåˆ«ï¼Œé¦–å…ˆä½¿ç”¨tornadoå®ç°ä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:utf-8 -*-</span><span class="token keyword">from</span> tornado<span class="token punctuation">.</span>web <span class="token keyword">import</span> RequestHandler<span class="token punctuation">,</span> Application<span class="token keyword">from</span> tornado<span class="token punctuation">.</span>ioloop <span class="token keyword">import</span> IOLoop<span class="token keyword">import</span> tornado<span class="token punctuation">.</span>gen<span class="token keyword">class</span> <span class="token class-name">TestHandle</span><span class="token punctuation">(</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">await</span> tornado<span class="token punctuation">.</span>gen<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app <span class="token operator">=</span> Application<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> TestHandle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>    IOLoop<span class="token punctuation">.</span>current<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è®©æœåŠ¡ç«¯åœ¨å¤„ç†è¯·æ±‚æ—¶æš‚åœ1ç§’ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ›´æ–¹ä¾¿è§‚å¯Ÿå‡ºä¸¤ç§æ–¹å¼å®ç°çš„å®¢æˆ·ç«¯åŒºåˆ«ï¼Œæ¥ä¸‹æ¥å…ˆå®ç°åŒæ­¥å®¢æˆ·ç«¯:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding:utf-8 -*-</span><span class="token keyword">import</span> socket<span class="token keyword">import</span> timeREQUEST_STR <span class="token operator">=</span> <span class="token string">'{method} {path} HTTP/1.0\r\n\r\n'</span><span class="token keyword">def</span> <span class="token function">block_client</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">,</span> method<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>    sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>REQUEST_STR<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>method<span class="token operator">=</span>method<span class="token punctuation">,</span> path<span class="token operator">=</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    response_body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response_stream <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> response_stream<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>response_body<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        response_body<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response_stream<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    count <span class="token operator">=</span> <span class="token number">3</span>    start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        block_client<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{} è¯·æ±‚{}æ¬¡, è¿è¡Œæ—¶é—´: {:.1f}ç§’"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>block_client<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> count<span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯åŠ¨æœåŠ¡ç«¯ï¼Œ å¼€å§‹æµ‹è¯•åŒæ­¥å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯éœ€è¦å¤šå°‘æ—¶é—´:</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; C:\Users\Administrator&gt;python client.pyblock_client è¯·æ±‚3æ¬¡, è¿è¡Œæ—¶é—´: 3.0ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸å‡ºæ‰€æ–™ï¼Œè¯·æ±‚ä¸‰æ¬¡ç”±äºæœåŠ¡å™¨æš‚åœäº†1ç§’æ€»è®¡ä½¿ç”¨æ—¶é—´ä¸º3ç§’ã€‚æ¥ä¸‹æ¥å®ç°IOå¤šè·¯å¤ç”¨å®¢æˆ·ç«¯ï¼Œæ¥çœ‹çœ‹IOå¤šè·¯å¤ç”¨çš„è¡¨ç°:</p><pre class="line-numbers language-none"><code class="language-none">from selectors import DefaultSelector, EVENT_WRITE, EVENT_READimport socketimport timeREQUEST_STR = '{method} {path} HTTP/1.0\r\n\r\n'JOBS_COUNT = 0select = DefaultSelector()class NoBlockClient:    def __init__(self):        self.result = []    def request(self, method, hostname, port, path):        global JOBS_COUNT        JOBS_COUNT += 1        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)        sock.setblocking(False)        try:            sock.connect((hostname, port))        except BlockingIOError:            pass        select.register(sock.fileno(), EVENT_WRITE, partial(self._send, sock, method, path))    def _send(self, sock, method, path):        select.unregister(sock.fileno())        sock.send(REQUEST_STR.format(method=method, path=path).encode())        select.register(sock.fileno(), EVENT_READ, partial(self._recv, sock))    def _recv(self, sock):        global JOBS_COUNT        response_stream = sock.recv(1024)        if not response_stream:            select.unregister(sock.fileno())            sock.close()            JOBS_COUNT -= 1        else:            self.result.append(response_stream)    def run(self):        while JOBS_COUNT:            events = select.select()            for key, mask in events:                callback = key.data                callback()        return self.resultstart_time = time.time()count = 3no_block_client = NoBlockClient()for _ in range(count):    no_block_client.request("GET", "127.0.0.1", 8080, "/")result = no_block_client.run()print("{} è¯·æ±‚{}æ¬¡, è¿è¡Œæ—¶é—´: {:.1f}ç§’".format(NoBlockClient.__name__, count, time.time() - start_time))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œå®¢æˆ·ç«¯:</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt;C:\Users\Administrator&gt;python no_block_client.pyNoBlockClient è¯·æ±‚3æ¬¡, è¿è¡Œæ—¶é—´: 1.0ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>éå¸¸æ˜æ˜¾çš„çœ‹è§æ—¶é—´ä¸Šçš„åŒºåˆ«ï¼Œè™½ç„¶ä»£ç çœ‹èµ·æ¥ç‰¹åˆ«çš„å¤æ‚ï¼Œ ä½†æ˜¯è¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯å°†æ¯ä¸€ä¸ªå‡½æ•°å¯¹åº”ä¸€ä¸ªäº‹ä»¶æ³¨å†Œè¿›sleelctä¸­ï¼Œ ç”±sleectè¿›è¡Œç›‘æ§ï¼Œ å¦‚æœæœ‰äº‹ä»¶è§¦å‘å°±è¿è¡Œå¯¹åº”çš„å‡½æ•°ã€‚</p><p>æˆ‘ä»¬åˆ†æä¸‹IOå¤šè·¯å¤ç”¨å®¢æˆ·ç«¯ä»£ç ï¼š</p><ol><li>select = DefaultSelector() è¯¥è¡Œä»£ç è¿”å›äº†å½“å‰å¹³å°IOå¤šè·¯å¤ç”¨æœ€ä½³å®ç°æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºï¼šselectã€pollã€epollã€dev/pollã€kqueue, ç”±äºæˆ‘æ˜¯ä½¿ç”¨winæ¥æµ‹è¯•æ‰€ä»¥DefaultSelector() è¿”å›äº†selectæ¨¡å‹ã€‚</li><li>NoBlockClient.request å‡½æ•°ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªéé˜»å¡å¥—æ¥å­—è¿æ¥è‡³ç›®æ ‡æœåŠ¡å™¨ï¼Œ å¹¶å°†å½“å‰å¥—æ¥å­—æ³¨å†Œè¿›selectä¸­ï¼Œ å½“å…¶çŠ¶æ€ä¸ºå¯å†™æ—¶ï¼Œ è¿è¡ŒNoBlockClient._send ï¼Œç›¸å½“äºä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚</li><li>NoBlockClient._send è´Ÿè´£å°†æ¶ˆæ¯å‘é€è‡³å·²è¿æ¥çš„æœåŠ¡å™¨ï¼Œæœ€åå¦‚åŒNoBlockClient.request ä¸€æ ·æ³¨å†Œäº‹ä»¶é€‰æ‹©å›è°ƒå‡½æ•°ã€‚</li><li>NoBlockClient._recv å½“æ³¨å†Œäº‹ä»¶ä¸ºå¯è¯»æ—¶ï¼Œ å°†è¿è¡Œè¯¥å‡½æ•°ï¼Œ è¯»å–æœåŠ¡å™¨è¿”å›æ•°æ®ï¼Œè‡³æ­¤ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚å°±ç»“æŸäº†ã€‚</li><li>NoBlockClient.run å‡½æ•°ä¸»è¦ä¸ºäº†è®©selectå¼€å§‹å¾ªç¯ç›‘å¬è¿™äº›æ³¨å†Œäº‹ä»¶çš„çŠ¶æ€ï¼Œå¹¶è¿è¡Œå›è°ƒå‡½æ•°ã€‚</li></ol><p>selectorsæ¨¡å—æ˜¯å¯¹selectæ¨¡å—å°è£…ï¼Œä½¿å¾—æˆ‘ä»¬ä¸ç”¨åœ¨æ„å½“å‰å¹³å°éœ€è¦ä½¿ç”¨ä»€ä¹ˆæ¨¡å‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›å½“å‰å¹³å°æœ€ä½³çš„æ¨¡å‹ï¼Œå¹¶å°†å„ä¸ªæ¨¡å‹çš„apiè¿›è¡Œæ•´åˆï¼Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„å†™å‡ºè·¨å¹³å°ä»£ç ã€‚ æœ€ç»å¸¸ä½¿ç”¨çš„å‡ ç§æ¨¡å‹åŒ…æ‹¬: select,ã€pollã€ epollï¼Œæ¥ä¸‹æ¥æ‰€ä»¥è¯´è¿™å‡ ç§æ¨¡å‹çš„åŒºåˆ«ï¼Œä¼˜ç¼ºç‚¹ä»¥åŠå¤§æ¦‚çš„å®ç°æ–¹å¼ã€‚</p><ol><li><p>select: selectå°†è¢«æ³¨å†Œçš„äº‹ä»¶æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶æ‹·è´åˆ°å†…æ ¸ç©ºé—´è¿›è¡Œç›‘å¬ï¼Œå¦‚æœè¿™äº›äº‹ä»¶å…¶ä¸­ä¸€ä¸ªæœ‰äº†å˜åŒ–é‚£ä¹ˆselectå°†å†æ¬¡æŠŠåŒ…å«äº‹ä»¶çš„åˆ—è¡¨æ‹·è´è¿›ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°±é€ æˆäº†èµ„æºä¸Šçš„æå¤§æµªè´¹ï¼Œ å¦‚æœselectåªç›‘å¬ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªäº‹ä»¶è¿˜å¥½ï¼Œ ä½†æ˜¯å½“selectéœ€è¦ç›‘å¬çš„äº‹ä»¶è¶Šæ¥è¶Šå¤šæ—¶ï¼Œselectçš„æ€§èƒ½å°†ä¼šç›´çº¿ä¸‹é™ã€‚è€Œä¸”selectå°†æ—¶é—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´æ—¶å¹¶ä¸ä¼šå‘Šè¯‰ç”¨æˆ·å“ªä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘äº†ï¼Œè€Œæ˜¯è¦ç”¨æˆ·è‡ªå·±å»éå†ã€‚å› ä¸ºselectç›‘å¬çš„äº‹ä»¶è¶Šå¤šæ€§èƒ½è¶Šå·®æ‰€ä»¥é€šå¸¸ç³»ç»Ÿå†…æ ¸éƒ½ä¼šå¯¹selectæ¨¡å‹ç›‘å¬æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œåœ¨pythonæºç ä¸­(<a href="https://github.com/python/cpython/blob/master/Modules/selectmodule.c">github: selectmodule.c</a>) ä½¿ç”¨å®å®šä¹‰å°†winä¸­selectç›‘å¬äº‹ä»¶é™åˆ¶åœ¨äº†512, å½“ç„¶selectçš„æœ€å¤§ä¼˜ç‚¹åˆ™æ˜¯å‡ ä¹æ‰€æœ‰çš„å¹³å°éƒ½æ”¯æŒselectã€‚</p></li><li><p>poll: å…¶å®ç°æ–¹å¼å‡ ä¹ä¸selectç›¸åŒï¼Œ æ‰€ä»¥selectæœ‰çš„ç¼ºç‚¹pollä¹Ÿæ‹¥æœ‰ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚è¯¦æƒ…è§<a href="https://blog.csdn.net/luojian5900339/article/details/54581852">polläº‹ä»¶æœºåˆ¶</a>ã€‚</p></li><li><p>epoll: epollç›¸æ¯”è¾ƒselectã€pollæœ‰äº†è´¨çš„æ”¹å˜ï¼Œepollå°†æ³¨å†Œçš„äº‹ä»¶éƒ½æ’å…¥åˆ°äº†çº¢é»‘æ ‘ä¸­ï¼Œçº¢é»‘æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ³¨å†Œçš„äº‹ä»¶ï¼Œ ç”±äºçº¢é»‘æ ‘æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(logn)ï¼Œæ‰€ä»¥ epollèƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿çš„å¯¹äº‹ä»¶è¿›è¡Œç®¡ç†ï¼Œ å¹¶ä¸”å…¶åœ¨äº‹ä»¶è¢«è§¦å‘æ—¶ä»…ä»…è¿”å›è¢«è§¦å‘çš„äº‹ä»¶è€Œä¸æ˜¯åƒselectå…¨éƒ¨è¿”å›ï¼Œ è¿™å¤§å¤§å¢åŠ äº†æ•ˆç‡ã€‚æ›´åŠ è¯¦ç»†çš„epollæ¨¡å‹ä»‹ç»è§<a href="https://blog.csdn.net/apacat/article/details/51375950">EPOLLçš„ç†è§£å’Œæ·±å…¥åˆ†æ</a>ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python dict</title>
      <link href="/2023/02/18/dict/"/>
      <url>/2023/02/18/dict/</url>
      
        <content type="html"><![CDATA[<p>pythonçš„dictæ˜¯ä¸€ç§æ˜ å°„ç±»å‹, åº•å±‚ä½¿ç”¨äº†å“ˆå¸Œè¡¨çš„æ–¹å¼æ¥å‚¨å­˜æ•°æ®, å› æ­¤dictçš„æŸ¥è¯¢é€Ÿåº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1),è¿™æ˜¯ä¸€ç§å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´çš„æ•°æ®ç»“æ„ã€‚</p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªkey-valueæ—¶ï¼Œé¦–å…ˆå°†å“ˆå¸Œå‡½æ•°ä½œç”¨äºkeyä¸Šè·å¾—ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œå°†è¿™ä¸ªæ•´å‹æ•°å­—ä¸å‚¨å­˜valueæ•°ç»„çš„é•¿åº¦å–ä½™ï¼Œ å¾—åˆ°è¯¥æ•°ç»„çš„ä¸‹æ ‡ï¼Œ è¯¥ä¸‹æ ‡å°±æ˜¯valueæ‰€å­˜æ”¾çš„ä½ç½®ã€‚ pythonåœ¨åˆå§‹åŒ–dictæ—¶é¦–å…ˆä¼šç”³è¯·ä¸€ä¸ªå¤§å°ä¸º8KBå·¦å³çš„æ•°ç»„ç”¨æ¥å­˜æ”¾valueï¼ˆè§dictobject.cç¬¬111è¡Œå®šä¹‰å­—å…¸æœ€å°å®¹é‡ï¼‰ ï¼Œå¦‚æœæ•°ç»„ä½ç½®ä¸å¤Ÿå­˜æ”¾åˆ™ä¼šå†å‘ç³»ç»Ÿç”³è¯·ä¸¤å€äºå½“å‰å®¹é‡çš„æ•°ç»„æ¥å­˜æ”¾valueã€‚</p><p>å¯¹äºå“ˆå¸Œå†²çªpythoné€‰æ‹©äº†å¼€æ”¾å¯»å€æ³•æ¥è§£å†³ï¼šå½“äº§ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œé€šè¿‡æ¢æµ‹å‡½æ•°è®¡ç®—å‡ºä¸‹ä¸€ä¸ªå€™é€‰ä½ç½®ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå€™é€‰ä½ç½®è¿˜æ˜¯æœ‰å†²çªï¼Œé‚£ä¹ˆä¸æ–­é€šè¿‡æ¢æµ‹å‡½æ•°å¾€ä¸‹æ‰¾ï¼Œç›´åˆ°æ‰¾ä¸ªä¸€ä¸ªç©ºæ§½æ¥å­˜æ”¾å¾…æ’å…¥å…ƒç´ ã€‚</p><p>dictçš„åˆå§‹åŒ–åœ¨<a href="https://github.com/python/cpython/blob/main/Objects/dictobject.c#L691">dictobject.PyDict_New:691</a>è¯¥å‡½æ•°ä¸­å®Œæˆï¼š</p><pre class="line-numbers language-none"><code class="language-none">PyObject * PyDict_New(void){dictkeys_incref(Py_EMPTY_KEYS);return new_dict(Py_EMPTY_KEYS, empty_values);}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨python3.6ä¹‹ådictçš„é”®çš„é¡ºåºä¿æŒäº†æ’å…¥æ—¶çš„é¡ºåº <a href="https://github.com/python/cpython/blob/main/Objects/dictobject.c#L13">dictobject.c:13</a></p><pre class="line-numbers language-none"><code class="language-none">As of Python 3.6, this is compact and ordered. Basic idea is described here:* https://mail.python.org/pipermail/python-dev/2012-December/123028.html* https://morepypy.blogspot.com/2015/01/faster-more-memory-efficient-and-more.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonæ·±æ‹·è´æµ…æ‹·è´</title>
      <link href="/2023/02/18/python-shen-kao-bei-qian-kao-bei/"/>
      <url>/2023/02/18/python-shen-kao-bei-qian-kao-bei/</url>
      
        <content type="html"><![CDATA[<p>è¯´åˆ°pythonä¸­çš„å¯¹è±¡æ‹·è´é—®é¢˜ï¼Œè¿˜å¾—çœ‹çœ‹iså’Œ==çš„åŒºåˆ«ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; a = [1,2,3,4]&gt;&gt;&gt; b = [1,2,3,4]&gt;&gt;&gt; a == bTrue&gt;&gt;&gt; a is bFalse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹è§aå’Œbä¸­çš„æ•°å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸isçš„ç»“æœå´ä¸æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯å› ä¸ºpythonä¸­æ¯”è¾ƒçš„æ˜¯aå’Œbçš„æ•°å€¼ç›¸ç­‰ï¼Œisæ¯”è¾ƒå¯¹è±¡çš„æ ‡è¯†æ˜¯å¦ç›¸ç­‰ã€‚æ‰€ä»¥åœ¨pythonä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨==æ¥æ¯”è¾ƒå¯¹è±¡çš„æ•°å€¼æ—¶å€™ç›¸ç­‰ï¼Œ åˆ¤æ–­å¯¹è±¡ç»‘å®šçš„å€¼æ—¶å€™æ˜¯None, æœ€å¥½ä½¿ç”¨isã€‚è¿™é‡Œé¢æœ‰ä¸€ä¸ªå‘ï¼Œä¸€äº›æ–°æ‰‹ç»å¸¸çŠ¯çš„é”™è¯¯ï¼Œç©ºå­—ç¬¦ä¸²ï¼Œç©ºåˆ—è¡¨ï¼Œç©ºå­—å…¸ï¼Œä»–ä»¬çš„éƒ½ç­‰äºFalseï¼Œä½†æ˜¯ä»–ä»¬éƒ½ä¸æ˜¯ï¼ˆä¸ç­‰äºï¼‰None,æ‰€ä»¥åœ¨åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ï¼Œå­—å…¸æ˜¯å¦ä¸ºç©ºæ—¶ï¼Œ ä¸è¦ç”¨Noneæ¥åšæ¯”è¾ƒ,å› ä¸ºè¿™äº›å˜é‡æ— è®ºæ˜¯ä»å¯¹è±¡æ ‡è¯†ï¼Œæ•°å€¼éƒ½ä¸Noneä¸ç›¸ç­‰ã€‚ â€ƒâ€ƒæˆ‘ä»¬å¹³å¸¸æ˜¯ç”¨çš„å¯¹è±¡å¤åˆ¶ä¸€èˆ¬éƒ½æ˜¯æµ…æ‹·è´ã€‚copyæ¨¡å—ä¸ºæˆ‘ä»¬æä¾›äº†copy(æµ…æ‹·è´)ï¼Œdeepcopy(æ·±æ‹·è´ï¼‰å‡½æ•°,</p><p>ä»€ä¹ˆæ˜¯æµ…æ‹·è´ï¼š<br>æµ…æ‹·è´å°±æ˜¯å°†æ‹·è´çš„å¯¹è±¡å¼•ç”¨æ‹·è´ä¸€ä»½ï¼Œæ‹·è´å¯¹è±¡æŒ‡å‘çš„æ˜¯è¢«æ‹·è´å¯¹è±¡çš„æ•°å€¼ï¼Œç®€å•çš„è¯´å°±æ˜¯ï¼Œåœ¨åŸæœ‰æ•°å€¼ä¸Šé¢å†æ·»åŠ çš„ä¸€ä»½å¼•ç”¨ã€‚</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; a =1&gt;&gt;&gt; b = a&gt;&gt;&gt; id(a)4297636352&gt;&gt;&gt; id(b)4297636352<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»€ä¹ˆæ˜¯æ·±æ‹·è´ï¼š<br>æ·±æ‹·è´å°±æ˜¯æ‹·è´å¯¹è±¡å¯¹è¢«æ‹·è´å¯¹è±¡æ•°å€¼ä¸Šå¤åˆ¶ä¸€ä»½ï¼Œç„¶åæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–°çš„å¯¹è±¡æ•°å€¼ï¼Œå¯¹è±¡æ ‡è¯†éƒ½æ˜¯å’Œè¢«æ‹·è´å¯¹è±¡ç›¸ç­‰çš„.</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; import copy&gt;&gt;&gt; a = [1,2,3]&gt;&gt;&gt; b = copy.deepcopy(a)&gt;&gt;&gt; b[1,2,3]&gt;&gt;&gt; a[1,2,3]&gt;&gt;&gt; a == bTrue&gt;&gt;&gt; a is bTrue&gt;&gt;&gt; id(a)4297636352&gt;&gt;&gt; id(b)4297636352&gt;&gt;&gt; a.append(0)&gt;&gt;&gt; a[1,2,3,0]&gt;&gt;&gt; b[1,2,3]&gt;&gt;&gt; b.append(9)&gt;&gt;&gt; b[1, 2, 3, 9]&gt;&gt;&gt; a[1, 2, 3, 0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸºäºè¿™ç§ç°è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç‰¹åˆ«æ³¨æ„å‡½æ•°åœ¨ä½¿ç”¨å¯å˜å‚æ•°ä½œä¸ºé»˜è®¤å‚æ•°ï¼Œå¦‚ä¸æ³¨æ„å°±ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; def a(x = []):... x.append(0)... print(x)&gt;&gt;&gt; a()[0]&gt;&gt;&gt; a()[0, 0]&gt;&gt;&gt; a()[0, 0, 0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨å¯å˜å¯¹è±¡ä½œä¸ºå‡½æ•°é»˜è®¤å‚æ•°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; def a(x = None):...     if x is None:...             x = []...     else:...             x.append(0)...     print(x)...&gt;&gt;&gt; a()[]&gt;&gt;&gt; a()[]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶åˆ›å»ºç±»åˆå§‹åŒ–ä¼ å‚ä¹Ÿæ˜¯ä½¿ç”¨æµ…æ‹·è´æ¥ä¼ é€’çš„ï¼Œè¿™æ ·å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; class A:...     def __init__(self, name):...         self.name = name...     def printf(self):...         print(self.name)...&gt;&gt;&gt; x = [1,2,3,4]&gt;&gt;&gt; a = A(x)&gt;&gt;&gt; a.printf()[1, 2, 3, 4]&gt;&gt;&gt; x.append(5)&gt;&gt;&gt; a.printf()[1, 2, 3, 4, 5]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¼ å…¥çš„å‚æ•°æ”¹å˜çš„æ—¶å€™ï¼Œç±»é‡Œé¢çš„å˜é‡çš„å€¼é¡µè·Ÿç€æ”¹å˜äº†ï¼Œè¿™ç§æƒ…å†µæ—¶æœ€éš¾å‘ç°çš„ã€‚æ·±æ‹·è´/æµ…æ‹·è´ä»–ä»¬æœ€å¤§çš„åŒºåˆ«å°±æ˜¯:æ·±æ‹·è´æ‹·è´çˆ¶çº§å¯¹è±¡åŠå…¶å­å¯¹è±¡; æµ…æ‹·è´åªæ‹·è´çˆ¶çº§å¯¹è±¡.</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åç«¯ä¼ ç»™å‰ç«¯int ç±»å‹æ•°æ®è‡ªå¢æˆ–è‡ªå‡</title>
      <link href="/2018/03/16/hou-duan-chuan-gei-qian-duan-int-lei-xing-shu-ju-zi-zeng-huo-zi-jian/"/>
      <url>/2018/03/16/hou-duan-chuan-gei-qian-duan-int-lei-xing-shu-ju-zi-zeng-huo-zi-jian/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºæˆ‘ä½¿ç”¨çš„python3 ,åœ¨pythonä¸­int ç±»å‹ä¸åƒå…¶ä»–è¯­è¨€çš„intç±»å‹ï¼Œ python å°†longç±»å‹ä¹ŸåŠ å…¥åˆ°äº†intä¸­ï¼Œ æ‰€ä»¥å†pythonä¸­èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºçš„intç±»å‹åœ¨å…¶ä»–çš„è¯­è¨€ä¸­ä¸ä¸€å®šèƒ½å¤Ÿæ­£ç¡®çš„æ˜¾ç¤ºï¼Œ å½“python ä¼ çš„int è¶…è¿‡äº†æµè§ˆå™¨æ‰€èƒ½è§£æçš„æœ€å¤§å€¼æ—¶å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œ å»ºè®®å°†è¾ƒå¤§çš„int ç±»å‹è½¬æ¢æˆstring åœ¨ä¼ ç»™å‰ç«¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonå†…ç½®å‡½æ•°</title>
      <link href="/2017/12/15/python-nei-zhi-han-shu/"/>
      <url>/2017/12/15/python-nei-zhi-han-shu/</url>
      
        <content type="html"><![CDATA[<p>abs(x): æ¥å—ä¸€ä¸ªæ•´æ•°æˆ–æµ®ç‚¹æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›è¯¥å‚æ•°çš„ç»å¯¹å€¼ï¼Œå¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå¤æ•°ï¼Œåˆ™è¿”å›å¤æ•°çš„æ¨¡ã€‚</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; abs(-1)1&gt;&gt;&gt; abs(4 - 8j)8.94427190999916<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>all(iter): æ¥å—ä¸€ä¸ªå¯è¿­ä»£ç±»å‹ï¼Œå¦‚æœè¯¥å‚æ•°å†…æ‰€æœ‰å…ƒç´ ä¸ºçœŸè¿”å›Trueï¼Œå¦åˆ™è¿”å›Falseã€‚</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; all([1,2,3,4,5])True&gt;&gt;&gt; all([1,2,3,4,0])False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>any(iter):æ¥å—ä¸€ä¸ªå¯è¿­ä»£ç±»å‹ä¸ºå‚æ•°,å¦‚æœè¯¥å‚æ•°å†…ä»»ä½•å…ƒç´ ä¸ºçœŸ,åˆ™è¿”å›True,å¦åˆ™è¿”å›False.</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; any([0, 0,1])True&gt;&gt;&gt; any([0, 0,0])False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>asicc(object):æ¥å—ä¸€ä¸ªå¯¹è±¡, å°†è°ƒç”¨è¯¥å¯¹è±¡çš„__repr__æ–¹æ³•, è¿”å›çš„å­—ç¬¦ä¸²ä¼šå°†\x,\u,\Uè¿›è¡Œè½¬ç§»è¾“å‡º.</p><pre class="line-numbers language-none"><code class="language-none">In [4]: class a:...:     def __repr__(self):...:         return "repr"In [5]: ascii(a())Out[5]: 'repr'In [9]: ascii("\n\rfdsafdsa")Out[9]: "'\\n\\rfdsafdsa'"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>bin(x):æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°, å¹¶å°†è¯¥å‚æ•°è½¬æ¢æˆä»¥â€0bâ€å‰ç¼€çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²,å¦‚æœxä¸æ˜¯ä¸€ä¸ªæ•´æ•°,é‚£ä¹ˆå°†ä¼šè°ƒç”¨å¯¹è±¡çš„__index__æ–¹æ³•çš„æ•´æ•°å¹¶è½¬æ¢æˆäºŒè¿›åˆ¶.</p><pre class="line-numbers language-none"><code class="language-none">In [15]: class a:...:     def __index__(self):...:         return 1In [14]: bin(1)Out[14]: '0b1'In [16]: bin(a())Out[16]: '0b1'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>bool([x]):å¦‚æœä¸ä¼ å‚æ•°,åˆ™é»˜è®¤è¿”å›Fase,å¦‚æœXæ˜¯ä¸€ä¸ªä¸æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°åˆ™é¦–å…ˆè°ƒç”¨å¯¹è±¡çš„__bool__æ–¹æ³•, å¦‚æœå¯¹è±¡çš„__bool__æ–¹æ³•æœªå®šä¹‰,å…¶æ¬¡è°ƒç”¨__len__æ–¹æ³•,å¦‚æœè¿”å›0åˆ™bool()è¿”å›False,å¦åˆ™è¿”å›True,å¦‚æœå¯¹è±¡__len__ã€__bool__æ–¹æ³•éƒ½æœªå®šä¹‰åˆ™é»˜è®¤è¿”å›True</p><pre class="line-numbers language-none"><code class="language-none">In [39]: bool(1)Out[39]: TrueIn [40]: bool(0.0)Out[40]: FalseIn [41]: bool(0 - 0j)Out[41]: FalseIn [43]: class a:...:     def __bool__(self): return True...:     def __len__(self): return 0In [45]: bool(a())Out[45]: TrueIn [44]: bool(a)Out[44]: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>bytearray([source[, encoding[, errors]]]):æ¥å—ä¸€ä¸ªå¤§äºç­‰äº0å°äº256çš„æ•´æ•°æˆ–è€…ä¸€ä¸ªå¯è¿­ä»£ç±»å‹ã€å¦‚æœå‚æ•°ä¸€ä¸ªå­—ç¬¦ä¸²,é‚£ä¹ˆå¿…é¡»æŒ‡å®šencoding. è¿”å›ä¸€ä¸ªæ–°çš„å­—èŠ‚æ•°ç»„.å¦‚æœä¼ å…¥ä¸€ä¸ªå¯¹è±¡é¦–å…ˆè°ƒç”¨è¯¥å¯¹è±¡__index__, å¦‚æœæœªå®šä¹‰__index__åˆ™è°ƒç”¨å¯¹è±¡__iter__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [64]: class a:...:     def __iter__(self):...:         for i in range(0, 256):...:             yield i...:     def __index__(self): return 1...:In [65]: bytearray(a())Out[65]: bytearray(b'\x00')In [48]: bytearray()Out[48]: bytearray(b'')In [49]: bytearray([1,2,3,4,5,6,7])Out[49]: bytearray(b'\x01\x02\x03\x04\x05\x06\x07')In [77]: bytearray(1)Out[77]: bytearray(b'\x00')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>bytes([source[, encoding[, errors]]]): å¦‚åŒbytearrayä½¿ç”¨æ–¹æ³•, ä¸è¿‡è¯¥å‡½æ•°è¿”å›çš„ä¸€ä¸ªä¸å¯å˜ç±»å‹.</p><pre class="line-numbers language-none"><code class="language-none">In [72]: class a:...:     def __iter__(self):...:         for i in range(0, 256):...:             yield i...:     def __index__(self): return 1...:In [73]: bytes(a())Out[73]: b'\x00'In [79]: bytes(1)Out[79]: b'\x00'In [80]: bytes()Out[80]: b''In [81]: bytes([1,2,3,4,5,6,7])Out[81]: b'\x01\x02\x03\x04\x05\x06\x07'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>callable(object):æ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°, å¦‚æœè¯¥å‚æ•°æ˜¯å¯ä»¥è°ƒç”¨çš„åˆ™è¿”å›True, å¦åˆ™è¿”å›False</p><pre class="line-numbers language-none"><code class="language-none">In [83]: class a:passIn [85]: callable(a)Out[85]: TrueIn [86]: callable(a())Out[86]: FalseIn [88]: class a:...:     def __call__(self):...:         return 1In [89]: callable(a())Out[89]: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>chr(i): æ¥å—ä¸€ä¸ªæ•´æ•°, è¿”å›è¯¥æ•´æ•°å¯¹åº”çš„Unicodeä»£ç ç‚¹çš„å­—ç¬¦ä¸²,è¯¥æ•´æ•°å¿…é¡»å¤§äºç­‰äº0,å°äºç­‰äº1114112.</p><pre class="line-numbers language-none"><code class="language-none">In [105]: chr(0)Out[105]: '\x00'In [99]: chr(1114111)Out[99]: '\U0010ffff'In [100]: chr(1114112) # è¶…å‡ºèŒƒå›´---------------------------------------------------------------------------ValueError                                Traceback (most recent call last)&lt;ipython-input-100-4857faf08086&gt; in &lt;module&gt;----&gt; 1 chr(1114112)ValueError: chr() arg not in range(0x110000)==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>@classmethod:è£…é¥°å™¨, ä½œç”¨äºç±»æ–¹æ³•ä¸Š, è¢«è£…é¥°çš„æ–¹æ³•å°†è½¬æ¢æˆç±»æ–¹æ³•,ç±»æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°å°†æ˜¯ç±»æœ¬èº«.</p><pre class="line-numbers language-none"><code class="language-none">In [110]: class a:...:     def a1(self):...:         print(self)...:     @classmethod...:     def a2(self): # æŒ‰ç…§çº¦å®šåº”è¯¥å°†selfä¿®æ”¹æˆclsæ¥ä»å­—é¢é‡ä¸ŠåŒºåˆ†ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•....:         print(self)...:In [111]: a().a1() # å®ä¾‹æ–¹æ³•&lt;__main__.a object at 0x00000245CBE815C0&gt;In [112]: a.a2() # ç±»æ–¹æ³•&lt;class '__main__.a'&gt;In [113]: a().a2() # å®ä¾‹å¯ä»¥è°ƒç”¨ç±»æ–¹æ³•&lt;class '__main__.a'&gt;In [115]: a.a1() # ç±»åœ¨æœªå®ä¾‹åŒ–ä¹‹å‰ä¸èƒ½è°ƒç”¨å®ä¾‹åŒ–æ–¹æ³•, å½“ç„¶æœ‰æ·å¾„å¯ä»¥èµ°,è¿™é‡Œåªæ˜¯åšäº†ä¸€ä¸ªåŒºåˆ†, ä¸å±•ç¤ºæ·å¾„---------------------------------------------------------------------------TypeError                                 Traceback (most recent call last)&lt;ipython-input-115-2656506098d9&gt; in &lt;module&gt;----&gt; 1 a.a1()TypeError: a1() missing 1 required positional argument: 'self'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>compile(source, filename, mode, flags=0, dont_inherit=False, optimize=-1):å°†ä¸€ä¸ªå­—ç¬¦ä¸²ç¼–è¯‘æˆå­—èŠ‚ä»£ç :</p><pre class="line-numbers language-none"><code class="language-none">source: å­—ç¬¦ä¸²æˆ–è€…ASTå¯¹è±¡,filename: ä»£ç æ–‡ä»¶åç§°ï¼Œå¦‚æœä¸æ˜¯ä»æ–‡ä»¶è¯»å–ä»£ç åˆ™ä¼ é€’ä¸€äº›å¯è¾¨è®¤çš„å€¼, å¦‚â€™â€™.mode: æŒ‡å®šç¼–è¯‘ä»£ç çš„ç§ç±»ã€‚å¯ä»¥æŒ‡å®šä¸º exec, eval, singleflags: å˜é‡ä½œç”¨åŸŸï¼Œå±€éƒ¨å‘½åç©ºé—´ï¼Œå¦‚æœè¢«æä¾›ï¼Œå¯ä»¥æ˜¯ä»»ä½•æ˜ å°„å¯¹è±¡ã€‚flagså’Œdont_inheritæ˜¯ç”¨æ¥æ§åˆ¶ç¼–è¯‘æºç æ—¶çš„æ ‡å¿—In [121]: d = compile("print(1)", "", "exec")In [122]: dOut[122]: &lt;code object &lt;module&gt; at 0x00000245CBF448A0, file "", line 1&gt;In [123]: exec(d)1complex([real[, imag]]): åˆ›å»ºä¸€ä¸ªå€¼ä¸º real + imag * j çš„å¤æ•°æˆ–è€…è½¬åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ•°ä¸ºå¤æ•°ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>In [125]: complex(1, 2)<br>Out[125]: (1+2j)<br>In [127]: complex(â€œ1â€)<br>Out[127]: (1+0j)<br>In [128]: complex(â€œ1+2jâ€) # æ­¤å¤„ä¸èƒ½æœ‰ç©ºæ ¼, å¦åˆ™ä¼šæŠ¥é”™<br>Out[128]: (1+2j)<br>delattr(object, name): æ¥å—ä¸€ä¸ªå¯¹è±¡ä»¥åŠä¸€ä¸ªå­—ç¬¦ä¸²,åˆ é™¤è¯¥å¯¹è±¡çš„nameå±æ€§,ä¹Ÿå¯ä»¥ä½¿ç”¨del object.nameæ¥å®ç°.</p><pre class="line-numbers language-none"><code class="language-none">In [144]: class a:...:     x = 1...:     y = 2...:In [145]: delattr(a, "x")In [147]: a.x---------------------------------------------------------------------------AttributeError                            Traceback (most recent call last)&lt;ipython-input-147-e27186f28a17&gt; in &lt;module&gt;----&gt; 1 a.xAttributeError: type object 'a' has no attribute 'x'In [148]: a.yOut[148]: 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>dict([object]):ç”¨äºåˆ›å»ºä¸€ä¸ªå­—å…¸.å¦‚æœä¸ä¼ å‚æ•°,åˆ™è¿”å›ä¸€ä¸ªç©ºçš„å­—å…¸.</p><pre class="line-numbers language-none"><code class="language-none">In [150]: dict()Out[150]: {}In [151]: dict(a=1, b=2)Out[151]: {'a': 1, 'b': 2}In [152]: dict({"a":1})Out[152]: {'a': 1}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>dir([object]):ä¸ä¼ å‚æ•°æ—¶, è¿”å›å½“å‰èŒƒå›´å†…å˜é‡ã€æ–¹æ³•å’Œå®šä¹‰çš„ç±»å‹åˆ—è¡¨,ä¼ å…¥å‚æ•°æ—¶è¿”å›è¯¥å‚æ•°çš„æ‰€æœ‰çš„å±æ€§ã€æ–¹æ³•, å¦‚æœè¯¥å‚æ•°å®šä¹‰äº†__dir__æ–¹æ³•, åˆ™ä½¿ç”¨__dir__è¿”å›å€¼, å¦åˆ™è¯¥å‡½æ•°å°†å°½å¯èƒ½çš„æœ€å¤§é™åº¦çš„æ”¶é›†è¯¥å¯¹è±¡çš„æ–¹æ³•ä»¥åŠå±æ€§.</p><pre class="line-numbers language-none"><code class="language-none">In [157]: dir("")Out[157]:['__add__','__class__','__contains__',...]In [155]: class a:...:     def __dir__(self):...:         return ["a", "b"]...:In [156]: dir(a())Out[156]: ['a', 'b']In [158]: class a:...:     x = 1...:     y = 2...:In [159]: dir(a)[...,'x','y']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>divmod(x, y): æ¥å—ä¸¤ä¸ªéå¤æ•°çš„æ•°å­—ä½œä¸ºå‚æ•°, è¿”å›X,Yçš„å•†å’Œä½™.</p><pre class="line-numbers language-none"><code class="language-none">In [160]: divmod(1, 2)Out[160]: (0, 1)In [161]: divmod(1.5, 2)Out[161]: (0.0, 1.5)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>enumerate(iterable, start=0):æ¥å—ä¸€ä¸ªå¯è¿­ä»£ç±»å‹ä»¥åŠä¸€ä¸ªå¯é€‰intç±»å‹çš„å‚æ•°, è¿”å›ä¸€ä¸ªæšä¸¾å¯¹è±¡.å¦‚æœæŒ‡å®šäº†startåˆ™è¯¥å¯è¿­ä»£å¯¹è±¡çš„ä¸‹è¾¹ä»startå¼€å§‹.</p><pre class="line-numbers language-none"><code class="language-none">In [163]: enumerate([1,2,3,4])Out[163]: &lt;enumerate at 0x245cbf50438&gt;In [164]: list(enumerate([1,2,3,4]))Out[164]: [(0, 1), (1, 2), (2, 3), (3, 4)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>eval(expression, globals=None, locals=None):æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„è¡¨è¾¾å¼, å¹¶æ‰§è¡Œè¯¥è¡¨è¾¾å¼,è¿”å›å…¶å€¼.</p><pre class="line-numbers language-none"><code class="language-none">expression: å­—ç¬¦ä¸²ç±»å‹çš„è¡¨è¾¾å¼.globals: å­—å…¸ç±»å‹, å˜é‡ä½œç”¨åŸŸï¼Œå…¨å±€å‘½åç©ºé—´.locals: ä»»ä½•çš„æ˜ å°„å¯¹è±¡, å˜é‡ä½œç”¨åŸŸï¼Œå±€éƒ¨å‘½åç©ºé—´.In [166]: eval("1 + 2")Out[166]: 3exec(object[, globals[, locals]]):è¯¥å‡½æ•°æä¾›åŠ¨æ€æ‰§è¡Œpythonä»£ç çš„åŠŸèƒ½,objectå¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä»£ç å¯¹è±¡. globalså¿…é¡»æ˜¯ä¸€ä¸ªå­—å…¸,localsåˆ™å¯ä»¥æ˜¯ä»»ä½•çš„æ˜ å°„å¯¹è±¡,In [168]: x = 1In [169]: exec("x + 2")In [172]: xOut[172]: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>filter(function,iterable):æ¥å—ä¸€ä¸ªå‡½æ•°å¯¹è±¡ä»¥åŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°, å°†å¯è¿­ä»£å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸­,å¦‚æœè¯¥å‡½æ•°è¿”å›Trueåˆ™ä¿ç•™å½“å‰å…ƒç´ ,å¦åˆ™åˆ é™¤å½“å‰å…ƒç´ .filterå‡½æ•°è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡.</p><pre class="line-numbers language-none"><code class="language-none">In [3]: list(filter(lambda x: False, [1,2,3,4]))Out[3]: []In [4]: list(filter(lambda x: True, [1,2,3,4]))Out[4]: [1, 2, 3, 4]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>float([x]): æ¥å—ä¸€ä¸ªå¯é€‰æ•´å‹ã€æµ®ç‚¹å‹ã€å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²ç±»å‹å‚æ•°, è¿”å›è¯¥å‚æ•°çš„æµ®ç‚¹ç±»å‹æ•°æ®,å¦‚æœXæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡é‚£ä¹ˆå°†è°ƒç”¨å¯¹è±¡çš„__float__æ–¹æ³•(ä»…æä¾›ç”¨æ–¹æ³•, å®Œæ•´æ–¹æ³•è§:float).</p><pre class="line-numbers language-none"><code class="language-none">In [6]: float("+1")Out[6]: 1.0In [7]: float("-1")Out[7]: -1.0In [8]: float("Inf")Out[8]: infIn [11]: float(1)Out[11]: 1.0In [12]: float(1.2)Out[12]: 1.2# è‡ªå®šä¹‰å¯¹è±¡In [14]: class a:...:     def __float__(self): return 1.0...:In [15]: float(a())Out[15]: 1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>format(value[,format_spec]):æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°, æ¥å—ä¸é™ä¸ªå‚æ•°ï¼Œä½ç½®å¯ä»¥ä¸æŒ‰é¡ºåº, å…¶æ•°å­—æ ¼å¼åŒ–ç¬¦å·è§èœé¸Ÿæ•™ç¨‹, å¯¹äºè‡ªå®šä¹‰å¯¹è±¡, åˆ™è°ƒç”¨å¯¹è±¡çš„__format__æ–¹æ³•, å¦‚æœå¯¹è±¡æ²¡æœ‰å®šä¹‰__format__åˆ™ä½¿ç”¨å¯¹è±¡__str__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [20]: "{}|{}".format(1, "dsa")Out[20]: '1|dsa'In [21]: "{1}|{0}".format(1, "dsa")Out[21]: 'dsa|1'In [22]: "{0}|{1}".format(1, "dsa")Out[22]: '1|dsa'In [23]: "{:.2f}".format(1.235646)Out[23]: '1.24'In [33]: class a:...:     def __format__(self, *args):...:         return "format"...:In [34]: "{}".format(a())Out[34]: 'format'In [36]: class a:...:     def __str__(self):...:         return "str"...:In [37]: "{}".format(a())Out[37]: 'str'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>frozenset([iterable]): æ¥å—ä¸€ä¸ªå¯é€‰çš„å¯è¿­ä»£ç±»å‹çš„å‚æ•°, è¿”å›ä¸€ä¸ªfrozensetå¯¹è±¡, è¯¥å¯¹è±¡ä¸setå¯¹è±¡åŸºæœ¬ç›¸ä¼¼, ä½†æ˜¯è¯¥å¯¹è±¡æ˜¯ä¸å¯å˜çš„.</p><pre class="line-numbers language-none"><code class="language-none">In [39]: frozenset()Out[39]: frozenset()In [40]: frozenset([1,2,1,1])Out[40]: frozenset({1, 2})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>getattr(object,name[,default]): æ¥å—ä¸¤ä¸ªå¿…é€‰å‚æ•°å’Œä¸€ä¸ªå¯é€‰å‚æ•°, è¯¥å‡½æ•°è¿”å›äº†object.nameçš„å€¼, å¦‚æœä¸å­˜åœ¨nameå±æ€§,å¹¶ä¸”æ²¡æœ‰ä¼ å…¥defaultå‚æ•°æ—¶åˆ™è§¦å‘å¼‚å¸¸, å¦‚æœä¼ å…¥äº†defaultå‚æ•°åˆ™æ²¡æœ‰æ‰¾åˆ°nameå±æ€§æ—¶è¿”å›default.</p><pre class="line-numbers language-none"><code class="language-none">In [45]: class a:...:     def b(self):...:         return "2"In [47]: getattr(a(), "b")()Out[47]: '2'getattr(a(), "b1", lambda : print("b1"))()b1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>globals(): è¿”å›å½“å‰æ‰€æœ‰å…¨å±€å˜é‡çš„å­—å…¸.</p><pre class="line-numbers language-none"><code class="language-none">In [49]: globals()Out[49]:{'__name__': '__main__','__doc__': 'Automatically created module for IPython interactive environment','__package__': None,...}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hasattr(object, name): æ¥å—ä¸¤ä¸ªå¿…é€‰å‚æ•°, æ£€æµ‹objectä¸­æ˜¯å¦æœ‰é‚£ä¹ˆå±æ€§.å¦‚æœæœ‰nameå±æ€§è¿”å›True,å¦åˆ™è¿”å›False.</p><pre class="line-numbers language-none"><code class="language-none">In [50]: class a:...:     b = 1...:In [51]: hasattr(a, "b")Out[51]: TrueIn [52]: hasattr(a, "b1")Out[52]: False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hash(object): æ¥å—ä¸€ä¸ªå¿…é€‰å‚æ•°, è¿”å›è¯¥å¯¹è±¡çš„æ•´å‹å“ˆå¸Œå€¼, å¦‚æœæ—¶è‡ªå®šä¹‰å¯¹è±¡åˆ™è°ƒç”¨å¯¹è±¡çš„__hash__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [56]: hash("fdsaf")Out[56]: 2111967917974353823In [58]: class a:...:     def __hash__(self):...:         return 9527...:In [59]: hash(a())Out[59]: 9527<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>help([object]): æ¥å—ä¸€ä¸ªå¯é€‰çš„å‚æ•°, è¯¥å‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„ç±»å‹, è¿”å›è¯¥å¯¹è±¡çš„å¸®åŠ©æ–‡æ¡£, å¦‚æœæ˜¯è‡ªå®šä¹‰å¯¹è±¡, åˆ™è¿”å›è¯¥å‡½æ•°æˆ–è€…ç±»çš„æ³¨é‡Š.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°åˆ™æ‹‰èµ·äº¤äº’å¼çš„å¸®åŠ©ç³»ç»Ÿ</p><pre class="line-numbers language-none"><code class="language-none">In [62]: help(1)Help on int object:class int(object)|  int(x=0) -&gt; integer...In [65]: class a:...:     """è¿™æ˜¯helpä¿¡æ¯"""...:     def b(self):...:         """è¿™ä¹Ÿæ˜¯helpä¿¡æ¯"""...:         passIn [66]: help(a())Help on a in module __main__ object:class a(builtins.object)|  è¿™æ˜¯helpä¿¡æ¯||  Methods defined here:||  b(self)|      è¿™ä¹Ÿæ˜¯helpä¿¡æ¯||  ----------------------------------------------------------------------|  Data descriptors defined here:||  __dict__|      dictionary for instance variables (if defined)||  __weakref__|      list of weak references to the object (if defined)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hex(x):æ¥å—ä¸€ä¸ªæ•´å‹ä½œä¸ºå¿…é€‰å‚æ•°, è¿”å›è¯¥å‚æ•°çš„16è¿›åˆ¶å­—ç¬¦ä¸², è¯¥å­—ç¬¦ä¸²ä»¥0xå¼€å¤´,å¦‚æœxæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡é‚£ä¹ˆè¯¥å¯¹è±¡å¿…é¡»å®ç°__index__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [72]: hex(185)Out[72]: '0xb9'In [74]: class a:...:     def __index__(self): return 1In [75]: hex(a())Out[75]: '0x1'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>id(object): è¿”å›è¯¥å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ä»¥æ•´å‹è¿”å›.</p><pre class="line-numbers language-none"><code class="language-none">In [77]: id(1)Out[77]: 1786755536In [81]: class a:...:     def __init__(self, x):...:         self.x = x...:In [82]: id(a(1)) == id(2)Out[82]: False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>input([prompt]): ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–è¾“å…¥ä¸€å›è½¦é”®ç»“æŸ, å¦‚æœä¼ å…¥prompt, åˆ™å°†promptæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­.</p><pre class="line-numbers language-none"><code class="language-none">In [84]: input("è¿™æ˜¯æç¤º:")è¿™æ˜¯æç¤º:ddOut[84]: 'dd'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>int(x, base=10):å°†ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ•°å­—è½¬æ¢ä¸ºæ•´å‹,å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°åˆ™è¿”å›0,å¦‚æœä¼ å…¥ä¼ å…¥äº†baseåˆ™è¡¨ç¤ºXæ˜¯baseè¿›åˆ¶çš„æ•°å­—.å¦‚æœXæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡, åˆ™è°ƒç”¨__init__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [86]: int()Out[86]: 0In [87]: int(1.0)Out[87]: 1In [90]: int("0x9b", 16)Out[90]: 155In [91]: class a:...:     def __int__(self):...:         return 1In [92]: int(a())Out[92]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>isinstance(object, classinfo):å¦‚æœobjectæ˜¯classinfoçš„å®ä¾‹æˆ–è€…å­ç±»çš„å®ä¾‹, è¿”å›True, å¦åˆ™è¿”å›False.å¦‚æœclassinfoæ˜¯ä¸€ä¸ªå…ƒç»„, é‚£ä¹ˆobjectåªè¦æ˜¯å…ƒç»„ä¸­ä»»æ„ä¸€ä¸ªå…ƒç´ çš„å­ç±»çš„å®ä¾‹æˆ–è€…å®ä¾‹åŒ–éƒ½è¿”å›True.</p><pre class="line-numbers language-none"><code class="language-none">In [94]: class a: passIn [95]: class b(a): passIn [99]: isinstance(b(), a)Out[99]: TrueIn [101]: isinstance(1, int)Out[101]: TrueIn [103]: isinstance(1, str)Out[103]: False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>issubclass(class, classinfo):å¦‚æœclassæ˜¯classinfoçš„å­ç±»è¿”å›true, ä½¿ç”¨æ–¹æ³•ä¸isinstanceç›¸åŒ.</p><pre class="line-numbers language-none"><code class="language-none">In [94]: class a: passIn [95]: class b(a): passIn [105]: issubclass(b, a)Out[105]: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>iter(object[,sentinel]):è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡, å¦‚æœæ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°, é‚£ä¹ˆobjectå¿…é¡»æ˜¯å®ç°äº†è¿­ä»£åè®®æˆ–è€…åºåˆ—åè®®å¦åˆ™å°†è§¦å‘TypeError, å¦‚æœä¼ å…¥äº†sentinelå‚æ•°é‚£ä¹ˆobjectå¿…é¡»æ˜¯å¯è°ƒç”¨å¯¹è±¡, æ­¤æ—¶æ¯è¿­ä»£ä¸€æ¬¡éƒ½è°ƒç”¨object,å¦‚æœobjectè¿”å›çš„å€¼ç­‰äºsentinelæ—¶,è§¦å‘StopIterationå¼‚å¸¸.</p><pre class="line-numbers language-none"><code class="language-none">In [108]: iter([1,2,3])Out[108]: &lt;list_iterator at 0x210bde35f98&gt;In [110]: class a:...:     def __iter__(self):...:         for i in range(10):...:             yield i...:In [111]: list(iter(a()))Out[111]: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]In [12]: def a():...:     global num...:     num += 1...:     if num &gt;= 10:...:         return -1...:     return numIn [13]: for i in iter(a, -1):...:     print(i)123456789<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>len(s): æ¥å—ä¸€ä¸ªåºåˆ—æˆ–è€…é›†åˆç±»å‹å¯¹è±¡, è¿”å›å…¶é•¿åº¦, å¦‚æœæ—¶è‡ªå®šä¹‰å¯¹è±¡, å°†ä¼šè°ƒç”¨å¯¹è±¡çš„__len__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [18]: len([1,2,3])Out[18]: 3In [19]: len({1:2, 3:4})Out[19]: 2In [20]: class a:...:     def __len__(self): return 1In [21]: len(a())Out[21]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>locals():è¿”å›å½“å‰æœ¬åœ°å’Œåªæœ‰å˜é‡çš„å€¼.</p><pre class="line-numbers language-none"><code class="language-none">In [24]: def a():...:     x = 1...:     print(locals())In [25]: a(){'x': 1}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>map(function,iterableâ€¦):è¿”å›ä¸€ä¸ªè¿­ä»£å™¨, è¯¥å‡½æ•°å°†functionåº”ç”¨ä¸æ¯ä¸€ä¸ªiterableå…ƒç´ ä¸Šå¹¶è¿”å›ç›´åˆ°å¯è¿­ä»£å¯¹è±¡è€—å°½.</p><pre class="line-numbers language-none"><code class="language-none">In [27]: map(lambda x: x ** 2, [1,2,3])Out[27]: &lt;map at 0x2aec3ae4a20&gt;In [28]: list(map(lambda x: x ** 2, [1,2,3]))Out[28]: [1, 4, 9]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>max(arg1,arg2,*args[,key]):æ¥å—å¤šä¸ªä½ç½®å‚æ•°æˆ–è€…ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡, è¿”å›å…¶ä¸­æœ€å¤§çš„å€¼.</p><pre class="line-numbers language-none"><code class="language-none">In [39]: max(1,2)Out[39]: 2In [40]: max([2,3,4,5])Out[40]: 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>memoryview(obj): è¿”å›objçš„å†…å­˜æŸ¥çœ‹å¯¹è±¡(å¯¹æ”¯æŒç¼“å†²åŒºåè®®çš„æ•°æ®è¿›è¡ŒåŒ…è£…ï¼Œåœ¨ä¸éœ€è¦å¤åˆ¶å¯¹è±¡åŸºç¡€ä¸Šå…è®¸Pythonä»£ç è®¿é—®).</p><pre class="line-numbers language-none"><code class="language-none">In [43]: a = b"dsadsad"In [44]: d = memoryview(a)In [47]: d[0]Out[47]: 10# æœªå¤åˆ¶æ•°æ®In [52]: id(d.obj)Out[52]: 2949631565952In [53]: id(a)Out[53]: 2949631565952<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>min(arg1ï¼Œarg2ï¼Œ* args[ï¼Œkey]): æ¥å—å¤šä¸ªä½ç½®å‚æ•°æˆ–è€…ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡, è¿”å›å…¶ä¸­æœ€å°çš„å€¼.</p><pre class="line-numbers language-none"><code class="language-none">In [55]: min(1,2)Out[55]: 1In [56]: min([1,2,3,5])Out[56]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>next(iterator[,default]): é€šè¿‡è°ƒç”¨iteratorçš„__next__æ–¹æ³•å¹¶è¿”å›å…¶å€¼.</p><pre class="line-numbers language-none"><code class="language-none">In [58]: class a:...:     def __next__(self):...:         for i in range(10):...:             yield iIn [60]: list(next(a()))Out[60]: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>object(): è¿”å›ä¸€ä¸ªæ–°çš„æ— ä»»ä½•ç‰¹å¾çš„å¯¹è±¡, objectæ—¶æ‰€æœ‰classçš„åŸºç±».</p><pre class="line-numbers language-none"><code class="language-none">In [105]: object()Out[105]: &lt;object at 0x2aec3a34880&gt;In [106]: class a:passIn [107]: issubclass(a, object)Out[107]: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>oct(x):æ¥å—ä¸€ä¸ªæ•´å‹ä½œä¸ºå‚æ•°è¿”å›ä»¥â€0oâ€ä¸ºå‰ç¼€çš„å…«è¿›åˆ¶å­—ç¬¦ä¸²,å¦‚æœxæ˜¯è‡ªå®šä¹‰å¯¹è±¡, åˆ™è°ƒç”¨è¯¥å¯¹è±¡çš„__index__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [109]: oct(1)Out[109]: '0o1'In [111]: class a:...:     def __index__(self): return 1In [112]: oct(a())Out[112]: '0o1'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>open(file,mode=â€™râ€™,buffering=-1,encoding=None,errors=None,newline=None,<br>closefd=True,opener=None):æ‰“å¼€fileæ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡, å…·ä½“å‚æ•°å€¼è§open.</p><pre class="line-numbers language-none"><code class="language-none">file: æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ä»¥åŠæ–‡ä»¶åmode: æ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼, é»˜è®¤"râ€buffering: ç”¨äºè®¾ç½®ç¼“å†²ç­–ç•¥, 0ä¸ºå…³é—­ç¼“å†², 1ä¸ºé€‰æ‹©è¡Œç¼“å†², &gt; 1ä»¥æŒ‡ç¤ºå›ºå®šå¤§å°çš„å—ç¼“å­˜åŒº.é»˜è®¤-1,äºŒè¿›åˆ¶æ–‡ä»¶ä»¥å›ºå®šå¤§å°çš„å—ç¼“å†² 4.encoding:ç”¨äºè§£ç æˆ–ç¼–ç æ–‡ä»¶çš„ç¼–ç çš„åç§°, é»˜è®¤ç¼–ç å–å†³äºæ‰€åœ¨çš„æ“ä½œç³»ç»Ÿ 5.errors:æŒ‡å®šå¦‚ä½•å¤„ç†ç¼–ç å’Œè§£ç é”™è¯¯, ä»…èƒ½åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹ä½¿ç”¨ 6.newline: æ§åˆ¶é€šç”¨æ¢è¡Œæ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼ˆä»…é€‚ç”¨äºæ–‡æœ¬æ¨¡å¼ï¼‰ã€‚å®ƒå¯ä»¥æ˜¯Noneï¼Œ''ï¼Œ'\nâ€™ï¼Œ'\râ€™ï¼Œå’Œâ€™\r\nâ€™In [114]: open("test.test", "w").write("fdsa")Out[114]: 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ord(c): æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹å‚æ•°, è¿”å›è¯¥Unicodeä»£ç ç‚¹çš„æ•´æ•°.</p><pre class="line-numbers language-none"><code class="language-none">In [116]: ord("a")Out[116]: 97In [117]: ord("ä½ ")Out[117]: 20320<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pow(x,y[,z]):å½“æœªä¼ å…¥Zå‚æ•°æ—¶,è¿”å›xçš„yæ¬¡æ–¹,å¦‚æœä¼ å…¥äº†Zåˆ™å¯¹ç»“æœå–ä½™.</p><pre class="line-numbers language-none"><code class="language-none">In [122]: pow(2,3)Out[122]: 8In [124]: pow(2,3, 2)Out[124]: 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>print(*objects,sep=â€™ â€˜,end=â€™\nâ€™,file=sys.stdout,flush=False):å°†objectså¯¹è±¡æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­,æ¯ä¸€ä¸ªobjectsä½¿ç”¨sepåˆ†å‰², ä»¥endç»“æŸ,å¯¹äºè‡ªå®šä¹‰å¯¹è±¡, é¦–å…ˆè°ƒç”¨å¯¹è±¡__str__æ–¹æ³•, å¦‚æœæ²¡æœ‰å®šä¹‰__str__æ–¹æ³•åˆ™è°ƒç”¨__repr__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [136]: class a:...:     def __str__(self): return "str"...:     def __repr__(self): return "repr"In [137]: print(a())str<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>property(fget=Noneï¼Œfset=Noneï¼Œfdel=Noneï¼Œdoc=None): å¯ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ä¹Ÿå¯ä½œä¸ºå‡½æ•°ä½¿ç”¨.ç”¨äºæ˜¾ç¤ºç±»å±æ€§çš„è¯»å–ã€è®¾ç½®ä»¥åŠåˆ é™¤. ä½œä¸ºå‡½æ•°ä½¿ç”¨æ—¶:</p><pre class="line-numbers language-none"><code class="language-none">In [140]: class a:...:     def __init__(self):...:         self._x = None...:...:     def getx(self):...:         return self._x...:...:     def setx(self, x):...:         self._x = x...:     def delx(self):...:         self._x = None...:     x = property(getx, setx, delx, "test")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨æ—¶:</p><pre class="line-numbers language-none"><code class="language-none">class a:def __init__(self):self._x = None@propertydef x(self):return self._x@x.fsetdef x(self, x):self._x = x@x.fdeldef x(self):self._x = Noneå‚æ•°:fget â€“ è·å–å±æ€§å€¼çš„å‡½æ•°fset â€“ è®¾ç½®å±æ€§å€¼çš„å‡½æ•°fdel â€“ åˆ é™¤å±æ€§å€¼å‡½æ•°doc â€“ å±æ€§æè¿°ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>range(start,stop[,step]):rangeå¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°, rangeæ—¶ä¸€ä¸ªä¸å¯å˜åºåˆ—ç±»å‹,è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡.</p><pre class="line-numbers language-none"><code class="language-none">In [149]: list(range(1, 10, 2))Out[149]: [1, 3, 5, 7, 9]In [150]: list(range(1, 10))Out[150]: [1, 2, 3, 4, 5, 6, 7, 8, 9]In [151]: list(range(10))Out[151]: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]In [152]: type(range) # éå‡½æ•°Out[152]: type<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>repr(object): è¿”å›å¯æ‰“å°çš„å­—ç¬¦ä¸²,æ­¤å‡½æ•°å°è¯•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åœ¨ä¼ é€’æ—¶ä¼šäº§ç”Ÿå…·æœ‰ç›¸åŒå€¼çš„å¯¹è±¡eval()ï¼Œå¦åˆ™è¡¨ç¤ºå½¢å¼æ˜¯ä¸€ä¸ªæ‹¬åœ¨å°–æ‹¬å·ä¸­çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«å¯¹è±¡ç±»å‹çš„åç§°ä»¥åŠå…¶ä»–ä¿¡æ¯é€šå¸¸åŒ…æ‹¬å¯¹è±¡çš„åç§°å’Œåœ°å€ã€‚ç±»å¯ä»¥é€šè¿‡å®šä¹‰__repr__()æ–¹æ³•æ¥æ§åˆ¶æ­¤å‡½æ•°ä¸ºå…¶å®ä¾‹è¿”å›çš„å†…å®¹.</p><pre class="line-numbers language-none"><code class="language-none">In [154]: repr(1)Out[154]: '1'In [155]: class a:...:     def __repr__(self): return "1"In [156]: repr(a())Out[156]: '1'In [157]: repr(a)Out[157]: "&lt;class '__main__.a'&gt;"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>reversed(seq):æ¥å—ä¸€ä¸ªå¯è¿­ä»£ç±»å‹, è¿”å›è¯¥å¯è¿­ä»£ç±»å‹çš„åå‘è¿­ä»£å™¨.</p><pre class="line-numbers language-none"><code class="language-none">In [161]: list(reversed(range(10)))Out[161]: [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>round(num, [, ndigits]): è¿”å›numå››èˆäº”å…¥ç²¾ç¡®åˆ°ndigitsç²¾åº¦æ•°å­—, å¦‚æœæ²¡æœ‰ä¼ å…¥ndigitsåˆ™è¿”å›æœ€æ¥è¿‘numçš„æ•´æ•°, å¦‚æœnumæ—¶ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡, åˆ™è°ƒç”¨__round__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [163]: round(1.2563, 2)Out[163]: 1.26In [164]: round(1.2563)Out[164]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>set([iterable]):è¿”å›ä¸€ä¸ªæ–°çš„setç±»å‹å¯¹è±¡, æ¥å—å¯é€‰å¯è¿­ä»£ç±»å‹å‚æ•°, å¹¶å°†å¯è¿­ä»£ç±»å‹å‚æ•°è½¬æ¢æˆsetç±»å‹è¿”å›.</p><pre class="line-numbers language-none"><code class="language-none">In [166]: set()Out[166]: set()In [167]: set([1,2,3])Out[167]: {1, 2, 3}In [168]: set(range(10))Out[168]: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>setattr(object, name, value): æ¥å—ä¸‰ä¸ªå¿…é€‰å‚æ•°, å°†object.nameå±æ€§èµ‹å€¼ä¸ºvalue.</p><pre class="line-numbers language-none"><code class="language-none">In [172]: class a: passIn [173]: a1 = a()In [174]: setattr(a1, "b", 1)In [175]: a1.bOut[175]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>slice(start,stop[,step]):è¿”å›è¡¨ç¤ºç”±æŒ‡å®šçš„ç´¢å¼•é›†çš„åˆ‡ç‰‡å¯¹è±¡, è¯¥å¯¹è±¡ä¸ºåªè¯»æ•°æ®å±æ€§.</p><pre class="line-numbers language-none"><code class="language-none">In [178]: slice(0, 1)Out[178]: slice(0, 1, None)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>sorted(iterable,*,key=None,reverse=False):å°†_iterable_å¯¹è±¡æ’åºåè¿”å›.</p><pre class="line-numbers language-none"><code class="language-none">key: å¯é€‰å…³é”®å­—å‚æ•°,_key_æŒ‡å®šä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºä»_iterableä¸­çš„_æ¯ä¸ªå…ƒç´ ä¸­æå–æ¯”è¾ƒé”®reverse: å¯é€‰å…³é”®å­—å‚æ•°, å¦‚æœè®¾ç½®ä¸ºTrueï¼Œåˆ™åˆ—è¡¨å…ƒç´ å°†æŒ‰ç…§æ¯ä¸ªæ¯”è¾ƒç›¸åçš„æ–¹å¼è¿›è¡Œæ’åº.In [181]: sorted(["12", "1", "34", "6", "90"], key=int)Out[181]: ['1', '6', '12', '34', '90']In [182]: sorted(["12", "1", "34", "6", "90"], key=int, reverse=True)Out[182]: ['90', '34', '12', '6', '1']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>@staticmethod: è£…é¥°å™¨å‡½æ•°, ä½œç”¨äºç±»æ–¹æ³•ä¸Š, å°†æ–¹æ³•è½¬æ¢æˆé™æ€æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [185]: class a:...:     @staticmethod...:     def b(x):...:         return xIn [186]: a.b(1)Out[186]: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>str(object=bâ€™â€™,encoding=â€™utf-8â€™,errors=â€™strictâ€™):è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å¯¹è±¡,å¦‚æœobjectæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡, é‚£ä¹ˆé¦–å…ˆä¼šè°ƒç”¨å¯¹è±¡çš„__str__æ–¹æ³•, å¦‚æœæ²¡æœ‰å®ç°__str__æ–¹æ³•åˆ™è°ƒç”¨__repr__æ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [194]: class a:...:     def __repr__(self): return "re"...:     def __str__(self): return "str"In [195]: str(a())Out[195]: 'str'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>sum(iterable[,start]):å¦‚æœæ²¡æœ‰ä¼ å…¥_start_å‚æ•°, åˆ™å°†_iterable_æ‰€æœ‰çš„å…ƒç´ å åŠ åè¿”å›, å¦‚æœä¼ å…¥äº†_start_å‚æ•°,åˆ™ä»_start_å‚æ•°å¼€å§‹å°†_iterable_çš„å…ƒç´ ä»å·¦è‡³å³çš„å åŠ .</p><pre class="line-numbers language-none"><code class="language-none">In [201]: sum([1,2,3], 8)Out[201]: 14In [207]: sum(range(1, 101))Out[207]: 5050<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>super([type[,object-or-type]]):è¯¥å‡½æ•°ç”¨äºè°ƒç”¨çˆ¶ç±»(è¶…ç±»)çš„ä¸€ä¸ªæ–¹æ³•.</p><pre class="line-numbers language-none"><code class="language-none">In [209]: class a:...:     def add(self, x):...:         return x + 1In [210]: class b(a):...:     def add(self, x):...:         return super().add(x)In [211]: b().add(1)Out[212]: 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>tuple([iterable]):è¿”å›ä¸€ä¸ªå…ƒç»„å¯¹è±¡, æ¥å—ä¸€ä¸ªå¯é€‰çš„å¯è¿­ä»£å‚æ•°, å¦‚æœä¼ å…¥äº†è¯¥å‚æ•°åˆ™å°†è¯¥å‚æ•°è½¬æ¢æˆå…ƒç»„å¯¹è±¡.</p><pre class="line-numbers language-none"><code class="language-none">In [214]: tuple([1,2,3,4])Out[214]: (1, 2, 3, 4)In [215]: tuple()Out[215]: ()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>type(name,bases,dict):åªä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å°†è¿”å›è¯¥å‚æ•°çš„ç±»å‹,ä½¿ç”¨ä¸‰ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°ç±»å‹å¯¹è±¡,nameåˆ™æˆä¸ºç±»å¯¹è±¡çš„åç§°,baseåˆ™è¡¨æ˜äº†å…¶çˆ¶ç±», å¯é€‰çš„å…³é”®å­—å‚æ•°åˆ™å°†æˆä¸ºç±»çš„å±æ€§.(typeæ˜¯ç±»å‹å®ä¾‹å…³ç³»çš„é¡¶ç«¯, objectæ˜¯çˆ¶å­å…³ç³»çš„é¡¶ç«¯ï¼Œæ‰€æœ‰çš„æ•°æ®ç±»å‹çš„çˆ¶ç±»éƒ½æ˜¯å®ƒ, Objectæ˜¯typeçš„ä¸€ä¸ªå®ä¾‹,Typeæ˜¯objectçš„å­ç±», è¯¦ç»†è§typeå’Œobjectä¹‹é—´çš„å…³ç³»)</p><pre class="line-numbers language-none"><code class="language-none">In [222]: d = type("objects", (), {"names": "this is name"})In [223]: dOut[223]: __main__.objectsIn [224]: d.namesOut[224]: 'this is name'In [217]: type(1)Out[217]: int<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>vars([object]):è¿”å›æ¨¡å—ã€ç±»ã€å®ä¾‹ã€å…¶ä»–å¯¹è±¡çš„__dict__å±æ€§.</p><pre class="line-numbers language-none"><code class="language-none">In [232]: class a:...:     x = 1In [233]: vars(a)Out[233]:mappingproxy({'__module__': '__main__','x': 1,'__dict__': &lt;attribute '__dict__' of 'a' objects&gt;,'__weakref__': &lt;attribute '__weakref__' of 'a' objects&gt;,'__doc__': None})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>zip(*iterables):å°†å¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­å¯¹åº”çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œç„¶åè¿”å›ç”±è¿™äº›å…ƒç»„ç»„æˆçš„åˆ—è¡¨,å¦‚æœå„ä¸ªè¿­ä»£å™¨çš„å…ƒç´ ä¸ªæ•°ä¸ä¸€è‡´ï¼Œåˆ™è¿”å›åˆ—è¡¨é•¿åº¦ä¸æœ€çŸ­çš„å¯¹è±¡ç›¸åŒ.</p><pre class="line-numbers language-none"><code class="language-none">In [237]: zip([1,2,3,4], ["q", "w", "e", "r"])Out[237]: &lt;zip at 0x2aec3ad6d88&gt;In [238]: list(zip([1,2,3,4], ["q", "w", "e", "r"]))Out[238]: [(1, 'q'), (2, 'w'), (3, 'e'), (4, 'r')]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>import(name,globals=None,locals=None,fromlist=(),level=0):import è¯­å¥å°†ä¼šè°ƒç”¨è¯¥å‡½æ•°,è¯¥å‡½æ•°å¯¼å…¥æ¨¡å—_name_, ä½¿ç”¨ç»™å®šçš„_globalså’Œ_localsæ¥ç¡®å®šå¦‚ä½•è§£é‡ŠåŒ…ä¸Šä¸‹æ–‡ä¸­çš„åç§°.</p><pre class="line-numbers language-none"><code class="language-none">In [240]: __import__("requests")Out[240]: &lt;module 'requests' from 'd:\\anaconda3\\envs\\python3\\lib\\site-packages\\requests\\__init__.py'&gt;In [241]: requests = __import__("requests")In [242]: requests.__version__Out[242]: '2.21.0'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> æŠ€æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>aiohttp,asyncio,RunTimeError</title>
      <link href="/2017/07/13/aiohttp-asyncio-runtimeerror/"/>
      <url>/2017/07/13/aiohttp-asyncio-runtimeerror/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆï¼Œä½ å¾—åˆ°çš„AssertionError: There is no current event loop in thread â€˜Thread-1â€™.æ˜¯å› ä¸ºasyncioç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œä½†å®ƒåªä¼šåœ¨ä¸»çº¿ç¨‹ä¸­ä¸ºä½ è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚æ‰€ä»¥å¦‚æœä½ asyncio.get_event_loopåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ä¸€æ¬¡ï¼Œå®ƒå°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¾ªç¯å¯¹è±¡å¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨ä¸€ä¸ªå­çº¿ç¨‹ä¸­å†æ¬¡è°ƒç”¨å®ƒï¼Œä½ ä¼šå¾—åˆ°è¿™ä¸ªé”™è¯¯ã€‚ç›¸åï¼Œæ‚¨éœ€è¦åœ¨çº¿ç¨‹å¯åŠ¨æ—¶æ˜¾å¼åˆ›å»º/è®¾ç½®äº‹ä»¶å¾ªç¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">loop = asyncio.new_event_loop()asyncio.set_event_loop(loop)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€æ—¦ä½ è¿™æ ·åšï¼Œä½ åº”è¯¥èƒ½å¤Ÿä½¿ç”¨get_event_loop()åœ¨ç‰¹å®šçš„çº¿ç¨‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµç•…çš„python--dictçš„ä¼˜ç‚¹ä»¥åŠç¼ºç‚¹</title>
      <link href="/2017/06/17/liu-chang-de-python-dict-de-you-dian-yi-ji-que-dian/"/>
      <url>/2017/06/17/liu-chang-de-python-dict-de-you-dian-yi-ji-que-dian/</url>
      
        <content type="html"><![CDATA[<p>1.å¥å¿…é¡»æ˜¯å¯æ•£åˆ—çš„ã€‚<br>ç”¨æˆ·è‡ªå·±å®ç°çš„å¯¹è±¡é»˜è®¤éƒ½æ˜¯å¯æ•£åˆ—çš„ï¼Œå› ä¸ºid()ä¸åŒã€‚ä¸€ä¸ªå¯æ•£åˆ—å¯¹è±¡åº”è¯¥æœ‰ä»¥ä¸‹å±æ€§ï¼š<br>æ”¯æŒhash()å‡½æ•°ï¼Œé€šè¿‡hash()æ–¹æ³•å¾—åˆ°çš„æ•£åˆ—å€¼æ˜¯ä¸å˜çš„ã€‚<br>å¯ä»¥é€šè¿‡eq()æ–¹æ³•æ¥æ£€æµ‹ç›¸ç­‰æ€§<br>å¦‚æœa == bï¼Œé‚£ä¹ˆhash(a) == hash(b)</p><p>2.å­—å…¸å†…å­˜å¼€é”€å¤§<br>å› ä¸ºå­—å…¸æ˜¯ç”±æ•£åˆ—è¡¨å®ç°çš„ï¼Œæ•£åˆ—è¡¨ä¸­è‚¯å®šå¯¹å‡ºç°ä¸€äº›ç¨€ç–ï¼Œè¿™å°±å¯¼è‡´äº†å­—å…¸ä¼šå ç”¨ä¸€äº›ç©ºé—´ã€‚å½“ç„¶å’Œå­—å…¸çš„é€Ÿåº¦ç›¸æ¯”è¿™ç‚¹å†…å­˜æ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚</p><p>3.å­—å…¸çš„å¥é¡ºåºä¸æ˜¯å”¯ä¸€çš„<br>ç”±äºæ•£åˆ—è¡¨åœ¨æ’å…¥æˆ–è€…è¯»å–æ—¶å€™å¯èƒ½ä¼šäº§ç”Ÿæ•£åˆ—å†²çªï¼Œè¿™å°±å¯¼è‡´äº†å­—å…¸ä¸­å¥çš„é¡ºåºä¸æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯ä¸ç®¡å­—å…¸å¥çš„é¡ºåºæ€ä¹ˆå˜ï¼Œå¦‚æœä¸¤ä¸ªå­—å…¸å¥å€¼å¯¹éƒ½ä¸€æ ·é‚£ä¹ˆè¿™ä¸¤ä¸ªå­—å…¸éƒ½æ˜¯ç›¸ç­‰çš„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">a = {"1":1,"2":3,"3":4,"4":4}b = {"3":3,"4":4,"1":1,"2":2}a == bTrue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµç•…çš„python--å­—å…¸ä¸­çš„æ•£åˆ—è¡¨</title>
      <link href="/2017/06/15/liu-chang-de-python-zi-dian-zhong-de-san-lie-biao/"/>
      <url>/2017/06/15/liu-chang-de-python-zi-dian-zhong-de-san-lie-biao/</url>
      
        <content type="html"><![CDATA[<p>å­—å…¸ä¸­çš„æ•£åˆ—è¡¨å…¶å®å°±æ˜¯ç¨€ç–æ•°ç»„ï¼ˆæ€»ä¼šæœ‰ä¸€äº›å…ƒç´ æ˜¯ç©ºç™½çš„æ•°ç»„ï¼‰ï¼Œæ•£åˆ—è¡¨ä¸­çš„å•å…ƒå«ï¼šè¡¨å…ƒï¼Œåœ¨æ„å»ºå­—å…¸æ—¶ä¼šæœ‰äº§ç”Ÿä¸¤ä¸ªè¡¨å…ƒï¼Œä¸€ä¸ªç”¨æ¥æ ‡è®°å¥ï¼Œä¸€ä¸ªç”¨æ¥æ ‡è®°å€¼ï¼Œå› ä¸ºä¸¤ä¸ªè¡¨å…ƒçš„é•¿åº¦éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¡¨å…ƒçš„åç§»é‡æ¥æŸ¥æ‰¾å­—å…¸ã€‚<br>pythonä¸­æœ€å…·æœ‰æ•ˆç‡çš„å†…ç½®æ•°æ®ç±»å‹å°±æ˜¯å­—å…¸å’Œé›†åˆï¼Œè¿™ä¸¤ç§éƒ½æ˜¯é€šè¿‡æ•£åˆ—è¡¨æ¥å®ç°çš„ã€‚ä¸ºäº†æµ‹è¯•pythonä¸­å­—å…¸ï¼Œé›†åˆå’Œå…¶ä»–çš„æ•°æ®ç±»å‹çš„é€Ÿåº¦æˆ‘åšäº†ä»¥ä¸‹çš„å®éªŒï¼š</p><pre class="line-numbers language-none"><code class="language-none">import timeMAX = 10000000list_a = [i for i in range(MAX)]set_a = set(list_a)dict_a = {}.fromkeys(list_a)test = [i for i in range(1000)]def testTime(x,name):start = time.clock()for i in test:if i in x:passprint name,':','%f' % (time.clock() - start)testTime(list_a, 'list')testTime(set_a, 'set')testTime(dict_a, 'dict')``````ç»“æœï¼š<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>list : 0.012472<br>set : 0.000079<br>dict : 0.000071</p><pre><code>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºé›†åˆä¸å­—å…¸ç›¸æ¯”å…¶ä»–ç±»å‹è¦å¿«å¾—å¤šï¼Œè¿™æ˜¯å› ä¸ºåˆ—è¡¨ä¸­æ²¡æœ‰æ•£åˆ—è¡¨æ”¯æŒinè¿ç®—ç¬¦ã€‚æ•£åˆ—çš„ç®—æ³•ï¼šæ¯”å¦‚pythonè¦è·å–dict[key]èƒŒåçš„å€¼ï¼Œpythonä¼šå…ˆä½¿ç”¨hash(key)æ¥è®¡ç®—keyçš„æ•£åˆ—å€¼ï¼Œç”¨ç„¶åå»æ•£åˆ—å€¼çš„æœ€ä½ä½çš„å‡ ä½æ•°å­—ä½œä¸ºè¡¨å…ƒçš„åç§»é‡ï¼Œå¦‚æœè¡¨å…ƒæ˜¯ç©ºçš„ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªKeyErrorå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°±ä¼šè·å¾—ä¸€ä¸ª:key:valueå€¼ï¼Œpythonå†æœ€åä¼šæ¯”è¾ƒä¸¤ä¸ªkeyçš„æ•£åˆ—å€¼æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸ºçœŸè¿”å›valueï¼Œå¦‚æœä¸ç›¸ç­‰è¿™æ—¶å€™å°±ç§°ä¸ºæ•£åˆ—å†²çªã€‚è¿™ç§æƒ…å†µçš„å‘ç”Ÿæ˜¯å› ä¸ºæ•£åˆ—è¡¨æŠŠéšæœºçš„å…ƒç´ æ˜ å°„åˆ°å‡ ä½æ•°å­—ä¸Šå»ã€‚è€Œæ•£åˆ—è¡¨æœ‰ä¾èµ–è¿™ä¸ªæ•°å­—åšæ£€ç´¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•£åˆ—è¡¨å°±ä¼šå†ä»æ–°å–å‡ ä½æ•°å­—ï¼Œå»è¡¨å…ƒä¸­å¯»æ‰¾ã€‚å¦‚æœè¡¨å…ƒä¸ºç©ºè¿™å›æŠ›å‡ºä¸€ä¸ªkeyerrorå¼‚å¸¸ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±ä¼šé‡å¤ä¸Šé¢çš„æ­¥éª¤ç›´åˆ°æ‰¾åˆ°ã€‚</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµç•…çš„python--ç‰¹æ®Šæ–¹æ³•</title>
      <link href="/2017/06/15/liu-chang-de-python-te-shu-fang-fa/"/>
      <url>/2017/06/15/liu-chang-de-python-te-shu-fang-fa/</url>
      
        <content type="html"><![CDATA[<p>pythonä¸­çš„ç‰¹æ®Šæ–¹æ³•æ˜¯ä¸»è¦æ˜¯è¢«pythonè§£é‡Šå™¨è°ƒç”¨ï¼Œå†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦è‡ªå·±å»å®ç°ç‰¹æ®Šæ–¹æ³•ï¼Œæ¯”å¦‚len(x)ï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯è°ƒç”¨çš„len()æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å®é™…ä¸­æˆ‘ä»¬ä¸ä¼šå»ä½¿ç”¨x.len()è¿™æ ·çš„ä¹¦å†™ã€‚å¦‚æœxæ˜¯ä¸€ä¸ªè‡ªå·±å®ç°çš„ç±»å¹¶ä¸”å†ç±»é‡Œé¢å®ç°äº†ä¸€ä¸ªlen()æ–¹æ³•ï¼Œé‚£ä¹ˆpythonå°±ä¼šå»è°ƒç”¨è¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•ã€‚<br>å¤§éƒ¨åˆ†æƒ…å†µä¸‹è°ƒç”¨ç‰¹æ®Šæ–¹æ³•éƒ½æ˜¯éšæ€§è°ƒç”¨ã€‚æ¯”å¦‚: for i in x: è¿™é‡Œå®é™…æ˜¯è°ƒç”¨äº†xçš„iter()æ–¹æ³•ï¼Œæ‰€æœ‰çš„ç‰¹æ®Šæ–¹æ³•éƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚ä½†æ˜¯åœ¨ç¼–ç¨‹æ—¶æ˜¯ä¸å»ºè®®å¤§é‡çš„å®ç°ç‰¹æ®Šæ–¹æ³•ï¼Œé™¤éå…ƒç¼–ç¨‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonæ ¹æ®exifä¿¡æ¯æ—‹è½¬å›¾ç‰‡</title>
      <link href="/2017/06/08/python-gen-ju-exif-xin-xi-xuan-zhuan-tu-pian/"/>
      <url>/2017/06/08/python-gen-ju-exif-xin-xi-xuan-zhuan-tu-pian/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‡ å¤©åœ¨å†™ä¸šåŠ¡ä»£ç æœ‰ä¸ªéœ€æ±‚ï¼šå‹ç¼©å›¾ç‰‡ã€‚æœ¬æ¥æ˜¯å¾ˆç®€å•éœ€æ±‚ï¼Œä¸‰ä¸‹äº”é™¤äºŒå°±å†™å¥½äº†ï¼Œä½†æ˜¯åœ¨è‡ªå·±ç”¨æ‰‹æœºä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™å‘ç°å‹ç¼©åçš„å›¾ç‰‡éƒ½æ­ªäº†ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼ŒåŸå› æ˜¯å›¾ç‰‡ä¸­çš„exifä¿¡æ¯ä¸­çš„Orientationè®°å½•ä¸­å›¾ç‰‡çš„æ—‹è½¬è§’åº¦ã€‚éœ€è¦æ ¹æ®è¿™ä¸ªæ¥æ—‹è½¬å›¾ç‰‡ã€‚</p><p>é¦–å…ˆè¯»å–å›¾ç‰‡çš„exifä¿¡æ¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">from PIL import Imageimg = Image.open('1.jpg')# å…ˆåˆ¤æ–­å›¾ç‰‡æ˜¯å¦æœ‰exifä¿¡æ¯if hasattr(img, '_getexif'):# è·å–exifä¿¡æ¯dict_exif = img._getexif()if dict_exif(274, 0) == 3:# æ—‹è½¬new_img = img.rotate(-90)elif dict_exif(274, 0) == 6:# æ—‹è½¬new_img = img.rotate(180)else:new_img = imgelse:new_img = imgnew_img.save('new_1.jpg', )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonçš„é«˜çº§ç”¨æ³• -- namedtuple</title>
      <link href="/2017/06/07/python-de-gao-ji-yong-fa-namedtuple/"/>
      <url>/2017/06/07/python-de-gao-ji-yong-fa-namedtuple/</url>
      
        <content type="html"><![CDATA[<p>namedtupleå‡½æ•°ç”¨æ¥æ„å»ºä¸€ä¸ªæœ‰åå­—çš„å…ƒç»„æˆ–è€…ç±»ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æ›´æœ‰æ•ˆçš„è°ƒè¯•<br>ä»£ç ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; from collections import namedtuple# åˆ›å»ºä¸€ä¸ªç±»&gt;&gt;&gt; a = namedtuple('c', ('name', 'age'))&gt;&gt;&gt; x = a('perror', 21)&gt;&gt;&gt; print xc(name='perror', age=21)&gt;&gt;&gt; # è¯¥è¿”å›å€¼å¯ä»¥ç”¨è®¿é—®å¯¹è±¡çš„æ–¹æ³•æ¥è®¿é—®&gt;&gt;&gt; print x.nameperror&gt;&gt;&gt; print x.age21&gt;&gt;&gt; # ä¹Ÿå¯ä»¥ç”¨æ ‡çš„æ–¹å¼å»è®¿é—®&gt;&gt;&gt; print x[0]perror<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘½åå…ƒç»„é™¤äº†ç»§æ‰¿æ™®é€šå…ƒç»„çš„æ–¹æ³•å¤–è¿˜æœ‰é¢å¤–çš„ä¸‰ä¸ªæ–¹æ³•ï¼š_fields ç±»å±æ€§ï¼Œmake() ç±»æ–¹æ³•ï¼Œ_asdict() ç±»å®ä¾‹æ–¹æ³•</p><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; # æŸ¥çœ‹è¯¥å‘½åå…ƒç»„ä¸­çš„æ‰€æœ‰å­—æ®µ&gt;&gt;&gt; x._fields('name', 'age')&gt;&gt;&gt; # _make é€šè¿‡ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æ¥ç”Ÿæˆä¸€ä¸ªç±»å®ä¾‹&gt;&gt;&gt;s = ('perror', '21')&gt;&gt;&gt; new_s = x._make(s)&gt;&gt;&gt; # é€šè¿‡ç±»å®ä¾‹æ–¹æ³•æ›´å‹å¥½çš„æ‰“å°å‡ºå…ƒç»„çš„å­—æ®µ&gt;&gt;&gt;new_s._asdict()OrderedDict([('name', 'perror'), ('age', 23)])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
